<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Set initial scale to 1 and enable responsiveness -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TEDPOLE</title>
  <!-- Base URL for relative paths (adjust as needed) -->
  <base href="https://backend-gw4i.onrender.com">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    /* Custom Styles for a Dynamic & Responsive Website */

    body {
      font-family: 'Arial', sans-serif;
      background-color: #fcfafa;
    }

    /* Center the authentication section and add padding for small devices */
    .center-section {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #000;
      padding: 15px;
    }

    /* Custom container with subtle background and shadow */
    .container-custom {
      background: rgba(0, 0, 0, 0.15);
      padding: 40px;
      max-width: 400px;
      width: 100%;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      border-radius: 8px;
      transition: all 0.5s ease;
    }

    .app-name {
      font-size: 24px;
      color: #4a90e2;
      font-weight: bold;
      margin-bottom: 20px;
      text-align: center;
    }

    .form-control {
      background: #2e3446;
      border: none;
      color: white;
      border-radius: 8px;
      padding: 10px 40px;
    }

    .form-control::placeholder {
      color: #b0b3c4;
    }

    .btn-primary {
      background: #4a90e2;
      border: none;
      border-radius: 8px;
      padding: 10px;
      font-weight: bold;
    }

    .btn-primary:hover {
      background: #357abd;
    }

    .form-label {
      color: #b0b3c4;
      font-weight: bold;
    }

    .toggle-link {
      color: #4a90e2;
      text-decoration: none;
      font-size: 0.9rem;
    }

    .toggle-link:hover {
      text-decoration: none;
    }

    /* Welcome message container */
    #welcome {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(to right, rgba(18,53,255,0.48), #151044);
      color: white;
      text-align: center;
      display: none;
      padding: 15px;
    }

    /* Main app content (hidden until authentication completes) */
    #appContent {
      display: none;
      color: #fff;
    }

    /* Positioning for password visibility icons and input icons */
    .password-container {
      position: relative;
    }

    .password-container .bi {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: #b0b3c4;
      cursor: pointer;
    }

    .input-icon {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: #b0b3c4;
    }

    .return-symbol {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 24px;
      color: #000;
      cursor: pointer;
      transition: color 0.3s ease;
    }

    .return-symbol:hover {
      color: #333;
    }

    .code-timer {
      color: #ff4d4d;
      font-weight: bold;
      margin-left: 10px;
    }

    .send-code-btn {
      background: #000;
      border: none;
      border-radius: 80px;
      padding: 5px 10px;
      color: white;
      cursor: pointer;
      margin-top: 10px;
    }

    .send-code-btn:hover {
      background: #357abd;
    }

    /* Camera and Chat sections styling */
    #camera, #chat {
      display: none;
      position: relative;
      padding: 15px;
    }

    #camera-preview {
      width: 100%;
      max-width: 600px;
      margin: 20px auto;
      display: block;
    }

    .capture-button {
      font-size: 24px;
      cursor: pointer;
      text-align: center;
      margin: 20px auto;
    }

    #chat-messages {
      height: 300px;
      overflow-y: auto;
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
      background: #fff;
      color: #000;
    }

    .chat-message {
      background: #4a90e2;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      margin-bottom: 5px;
    }

    /* Navbar styles */
    .navbar {
      background-color: #0400ff !important;
    }

    .navbar-brand, .nav-link {
      color: #fff !important;
    }

    .nav-link:hover {
      color: #4a90e2 !important;
    }

    .profile-dropdown {
      position: relative;
    }

    .profile-dropdown .dropdown-menu {
      right: 0;
      left: auto;
    }

    .profile-dropdown .dropdown-item {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .code-input-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .code-input-container .form-control {
      flex: 1;
    }

    .code-input-container .btn {
      white-space: nowrap;
    }

    /* Fade In Animation for smooth transitions */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-in {
      animation: fadeIn 0.5s;
    }

    /* Media Queries for Smaller Screens */
    @media (max-width: 576px) {
      .container-custom {
        padding: 20px;
        max-width: 100%;
      }
      .app-name {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <!-- Authentication Section -->
  <div id="auth-section" class="center-section">
    <!-- Signup Container -->
    <div class="container-custom fade-in" id="signup-container">
      <div class="app-name">TEDPOLE</div>
      <form id="signup-form" class="needs-validation" novalidate>
        <div class="mb-3">
          <label for="signup-email" class="form-label"></label>
          <div class="position-relative">
            <i class="bi bi-person input-icon"></i>
            <input type="email" class="form-control" id="signup-email" placeholder="Email-Address" required>
            <div class="invalid-feedback">
              Please provide a valid email.
            </div>
          </div>
        </div>
        <div class="mb-3 password-container" onclick="focusPassword('signup-password')">
          <label for="signup-password" class="form-label"></label>
          <div class="position-relative">
            <i class="bi bi-shield-lock input-icon"></i>
            <input type="password" class="form-control" id="signup-password" placeholder="Password" required>
            <i class="bi bi-eye" id="toggleSignupPassword"></i>
            <div class="invalid-feedback">
              Please provide a password.
            </div>
          </div>
        </div>
        <div class="mb-3 password-container" onclick="focusPassword('confirm-password')">
          <label for="confirm-password" class="form-label"></label>
          <div class="position-relative">
            <i class="bi bi-shield-lock input-icon"></i>
            <input type="password" class="form-control" id="confirm-password" placeholder="Confirm password" required>
            <i class="bi bi-eye" id="toggleConfirmPassword"></i>
            <div class="invalid-feedback">
              Passwords do not match.
            </div>
          </div>
        </div>
        <div class="mb-3">
          <label for="signup-code" class="form-label"></label>
          <div class="code-input-container">
            <div class="position-relative" style="flex:1;">
              <i class="bi bi-key input-icon"></i>
              <input type="text" class="form-control" id="signup-code" placeholder="Enter Code" required>
              <div class="invalid-feedback">
                Please provide a code.
              </div>
            </div>
            <button type="button" class="btn btn-primary" id="send-code-btn" onclick="sendCode()">Send Code</button>
          </div>
          <span id="code-timer" class="code-timer"></span>
        </div>
        <button type="submit" class="btn btn-primary w-100 mt-1">Sign Up</button>
      </form>
      <button type="button" class="btn btn-link mt-1" onclick="toggleForm('login')">Log In</button>
    </div>
    
    <!-- Login Container -->
    <div class="container-custom fade-in" id="login-container" style="display: none;">
      <div class="app-name">TEDPOLE</div>
      <form id="login-form" class="needs-validation" novalidate>
        <div class="mb-3">
          <label for="login-email" class="form-label"></label>
          <div class="position-relative">
            <i class="bi bi-person input-icon"></i>
            <input type="email" class="form-control" id="login-email" placeholder="Email-Address" required>
            <div class="invalid-feedback">
              Please provide a valid email.
            </div>
          </div>
        </div>
        <div class="mb-3 password-container" onclick="focusPassword('login-password')">
          <label for="login-password" class="form-label"></label>
          <div class="position-relative">
            <i class="bi bi-shield-lock input-icon"></i>
            <input type="password" class="form-control" id="login-password" placeholder="Password" required>
            <i class="bi bi-eye" id="toggleLoginPassword"></i>
            <div class="invalid-feedback">
              Please provide a password.
            </div>
          </div>
        </div>
        <button type="submit" class="btn btn-primary w-100">Log In</button>
      </form>
      <!-- Links placed side-by-side -->
      <div class="d-flex justify-content-between mt-1">
        <a href="#" class="toggle-link" onclick="toggleForm('forgot')">Forgot Password!</a>
        <a href="#" class="toggle-link" onclick="toggleForm('signup')">Sign Up</a>
      </div>
    </div>
    
    <!-- Forgot Password Container -->
    <div class="container-custom fade-in" id="forgot-container" style="display: none;">
      <div class="app-name">TEDPOLE</div>
      <form id="forgot-form" class="needs-validation" novalidate>
        <div class="mb-3">
          <label for="forgot-email" class="form-label"></label>
          <div class="position-relative">
            <i class="bi bi-person input-icon"></i>
            <input type="email" class="form-control" id="forgot-email" placeholder="Email-Address" required>
            <div class="invalid-feedback">
              Please provide a valid email.
            </div>
          </div>
        </div>
        <button type="submit" class="btn btn-primary w-100">Reset Password</button>
      </form>
      <div class="d-flex justify-content-between mt-1">
        <a href="#" class="toggle-link" onclick="toggleForm('login')">Back to Login</a>
        <a href="#" class="toggle-link" onclick="toggleForm('signup')">Sign Up</a>
      </div>
    </div>
  </div>

  <!-- Welcome Message (shown briefly after login/signup) -->
  <div id="welcome">
    <div>
      <h1>TEDPOLE</h1>
      <img src="/mnt/data/TEDPOLE LOGO.png" alt="TEDPOLE Logo" class="rounded-circle" style="max-width: 150px;">
    </div>
  </div>

  <!-- Main App Content -->
  <div id="appContent">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm sticky-top">
      <div class="container">
        <a class="navbar-brand fw-bold" href="#">TEDPOLE</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item"><a class="nav-link" href="#home">Home</a></li>
            <li class="nav-item dropdown profile-dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                <i class="bi bi-person-circle"></i>
              </a>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                <li><a class="dropdown-item" href="#"><i class="bi bi-person"></i> My Profile (<span id="user-email"></span>)</a></li>
                <li><a class="dropdown-item" href="#"><i class="bi bi-gear"></i> Settings</a></li>
                <li><a class="dropdown-item" href="#"><i class="bi bi-headset"></i> Contact Us</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#" onclick="logout()"><i class="bi bi-box-arrow-right"></i> Logout</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Features Section -->
    <section class="py-5" id="features">
      <div class="container">
        <h2 class="text-center mb-4">Features</h2>
        <div class="row g-4">
          <div class="col-md-6">
            <div class="card shadow feature-card">
              <div class="card-body text-center">
                <i class="bi bi-camera2 display-4 text-primary"></i>
                <h4 class="mt-3">Capture Moments</h4>
                <p>Take photos and record videos with TEDPOLE.</p>
                <a href="#camera" class="btn btn-primary" onclick="openCamera()">Open Camera</a>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card shadow feature-card">
              <div class="card-body text-center">
                <i class="bi bi-people display-4 text-primary"></i>
                <h4 class="mt-3">Connect with Friends</h4>
                <p>Chat and invite your friends to join TEDPOLE.</p>
                <a href="#chat" class="btn btn-primary" onclick="openChat()">Connect Now</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Camera Section -->
    <section id="camera">
      <div class="return-symbol" onclick="closeCamera()">‚Üê</div>
      <h2 class="text-center text-white">Camera Feature</h2>
      <video id="camera-preview" autoplay></video>
      <div class="text-center">
        <div class="capture-button" id="capture-photo">üì∏</div>
        <button id="record-video" class="btn btn-danger">Record Video</button>
        <button id="stop-video" class="btn btn-secondary" style="display: none;">Stop Recording</button>
      </div>
    </section>

    <!-- Chat Section -->
    <section id="chat">
      <div class="return-symbol" onclick="closeChat()">‚Üê</div>
      <h2 class="text-center">Chat Feature</h2>
      <div id="chat-messages"></div>
      <div class="p-3">
        <input type="text" id="chat-input" class="form-control" placeholder="Type a message...">
        <button class="btn btn-primary mt-2" id="send-chat-btn">Send</button>
      </div>
    </section>

    <!-- Footer -->
    <footer class="py-4">
      <div class="container text-center">
        <p>&copy; 2023 TEDPOLE. All rights reserved.</p>
      </div>
    </footer>
  </div>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Combined JavaScript Code -->
  <script>
    // Element references
    const authSection         = document.getElementById('auth-section');
    const signupContainer     = document.getElementById('signup-container');
    const loginContainer      = document.getElementById('login-container');
    const forgotContainer     = document.getElementById('forgot-container');
    const welcome             = document.getElementById('welcome');
    const appContent          = document.getElementById('appContent');
    const userEmailEl         = document.getElementById('user-email');

    // Forms and inputs
    const signupForm          = document.getElementById('signup-form');
    const loginForm           = document.getElementById('login-form');
    const forgotForm          = document.getElementById('forgot-form');
    const signupEmail         = document.getElementById('signup-email');
    const loginEmail          = document.getElementById('login-email');
    const forgotEmail         = document.getElementById('forgot-email');
    const signupPassword      = document.getElementById('signup-password');
    const loginPassword       = document.getElementById('login-password');
    const confirmPassword     = document.getElementById('confirm-password');
    const signupCodeInput     = document.getElementById('signup-code');
    const codeTimer           = document.getElementById('code-timer');
    const sendCodeBtn         = document.getElementById('send-code-btn');

    // Password toggle icons
    const toggleSignupPassword   = document.getElementById('toggleSignupPassword');
    const toggleLoginPassword    = document.getElementById('toggleLoginPassword');
    const toggleConfirmPassword  = document.getElementById('toggleConfirmPassword');

    // Camera elements
    const cameraPreview       = document.getElementById('camera-preview');
    const capturePhotoButton  = document.getElementById('capture-photo');
    const recordVideoButton   = document.getElementById('record-video');
    const stopVideoButton     = document.getElementById('stop-video');

    // Chat elements
    const chatMessages        = document.getElementById('chat-messages');
    const chatInput           = document.getElementById('chat-input');
    const sendChatBtn         = document.getElementById('send-chat-btn');

    // Variables for camera/video
    let mediaStream, mediaRecorder, recordedChunks = [];

    // Verification code and timer variables
    let verificationCode, timerInterval;

    // Logged in user email
    let loggedInUserEmail = '';

    /* --------------------- Authentication --------------------- */

    // Sign Up Form Submission with Verification Code and Backend call
    signupForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!signupForm.checkValidity()) {
        e.stopPropagation();
        signupForm.classList.add('was-validated');
        return;
      }
      const email    = signupEmail.value.trim();
      const password = signupPassword.value;
      const confirm  = confirmPassword.value;
      const code     = signupCodeInput.value.trim();

      if (password !== confirm) {
        alert('Passwords do not match');
        return;
      }
      if (code != verificationCode) {
        alert('Invalid verification code');
        return;
      }

      try {
        const response = await fetch('http://localhost:3000/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });
        const data = await response.json();
        alert(data.message);
        if (response.status === 201) {
          loggedInUserEmail = email;
          userEmailEl.textContent = loggedInUserEmail;
          authSection.style.display = 'none';
          welcome.style.display = 'flex';
          setTimeout(() => {
            welcome.style.display = 'none';
            appContent.style.display = 'block';
          }, 2000);
        }
      } catch (error) {
        console.error('Signup Error:', error);
        alert('Signup failed. Please try again.');
      }
    });

    // Login Form Submission with Backend call
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!loginForm.checkValidity()) {
        e.stopPropagation();
        loginForm.classList.add('was-validated');
        return;
      }
      const email    = loginEmail.value.trim();
      const password = loginPassword.value;
      try {
        const response = await fetch('http://localhost:3000/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });
        const data = await response.json();
        if (response.status === 200) {
          loggedInUserEmail = email;
          userEmailEl.textContent = loggedInUserEmail;
          authSection.style.display = 'none';
          welcome.style.display = 'flex';
          setTimeout(() => {
            welcome.style.display = 'none';
            appContent.style.display = 'block';
          }, 2000);
        } else {
          alert(data.message);
        }
      } catch (error) {
        console.error('Login Error:', error);
        alert('Login failed. Please try again.');
      }
    });

    // Forgot Password Form Submission with Backend call
    forgotForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!forgotForm.checkValidity()) {
        e.stopPropagation();
        forgotForm.classList.add('was-validated');
        return;
      }
      const email = forgotEmail.value.trim();
      try {
        const response = await fetch('http://localhost:3000/forgot-password', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });
        const data = await response.json();
        alert(data.message);
        toggleForm('login');
      } catch (error) {
        console.error('Forgot Password Error:', error);
        alert('Reset password request failed.');
      }
    });

    /* --------------------- Verification Code --------------------- */

    // Generate a random 6-digit code
    function generateCode() {
      return Math.floor(100000 + Math.random() * 900000);
    }

    // Simulate sending the verification code and start the timer
    function sendCode() {
      const email = signupEmail.value.trim();
      if (!email) {
        alert('Please enter your email first.');
        return;
      }
      verificationCode = generateCode();
      alert(`Verification code sent to ${email}: ${verificationCode}`);
      startTimer();
      sendCodeBtn.disabled = true;
    }

    // Start a 60-second countdown timer
    function startTimer() {
      let timeLeft = 60;
      codeTimer.textContent = `00:${timeLeft < 10 ? '0' : ''}${timeLeft}`;
      timerInterval = setInterval(() => {
        timeLeft--;
        codeTimer.textContent = timeLeft >= 0 ? `00:${timeLeft < 10 ? '0' : ''}${timeLeft}` : "Time's up!";
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          sendCodeBtn.disabled = false;
        }
      }, 1000);
    }

    /* --------------------- Password Visibility --------------------- */

    toggleSignupPassword.addEventListener('click', () => {
      const type = signupPassword.getAttribute('type') === 'password' ? 'text' : 'password';
      signupPassword.setAttribute('type', type);
      toggleSignupPassword.classList.toggle('bi-eye-slash');
    });

    toggleLoginPassword.addEventListener('click', () => {
      const type = loginPassword.getAttribute('type') === 'password' ? 'text' : 'password';
      loginPassword.setAttribute('type', type);
      toggleLoginPassword.classList.toggle('bi-eye-slash');
    });

    toggleConfirmPassword.addEventListener('click', () => {
      const type = confirmPassword.getAttribute('type') === 'password' ? 'text' : 'password';
      confirmPassword.setAttribute('type', type);
      toggleConfirmPassword.classList.toggle('bi-eye-slash');
    });

    // Helper to focus on password fields when container is clicked
    function focusPassword(id) {
      document.getElementById(id).focus();
    }

    // Toggle between Signup, Login, and Forgot Password forms with fade-in effect
    function toggleForm(form) {
      signupContainer.classList.remove('fade-in');
      loginContainer.classList.remove('fade-in');
      forgotContainer.classList.remove('fade-in');
      if(form === 'login'){
        signupContainer.style.display = 'none';
        forgotContainer.style.display = 'none';
        loginContainer.style.display = 'block';
        loginContainer.classList.add('fade-in');
      } else if (form === 'signup'){
        loginContainer.style.display = 'none';
        forgotContainer.style.display = 'none';
        signupContainer.style.display = 'block';
        signupContainer.classList.add('fade-in');
      } else if (form === 'forgot'){
        loginContainer.style.display = 'none';
        signupContainer.style.display = 'none';
        forgotContainer.style.display = 'block';
        forgotContainer.classList.add('fade-in');
      }
    }

    /* --------------------- Camera Feature --------------------- */

    // Open the camera, hide features, and show the camera section
    async function openCamera() {
      document.getElementById('features').style.display = 'none';
      document.getElementById('camera').style.display = 'flex';
      try {
        mediaStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        cameraPreview.srcObject = mediaStream;
      } catch (error) {
        console.error('Error accessing camera:', error);
        alert('Cannot access camera.');
      }
    }

    // Capture photo from the video stream and download it as an image
    capturePhotoButton.addEventListener('click', () => {
      const canvas = document.createElement('canvas');
      canvas.width = cameraPreview.videoWidth;
      canvas.height = cameraPreview.videoHeight;
      const context = canvas.getContext('2d');
      context.drawImage(cameraPreview, 0, 0, canvas.width, canvas.height);
      const imageUrl = canvas.toDataURL('image/png');
      const link = document.createElement('a');
      link.href = imageUrl;
      link.download = 'photo.png';
      link.click();
    });

    // Record video from the camera stream using MediaRecorder
    recordVideoButton.addEventListener('click', () => {
      recordedChunks = [];
      try {
        mediaRecorder = new MediaRecorder(mediaStream, { mimeType: 'video/webm' });
      } catch (e) {
        console.error('MediaRecorder not supported', e);
        alert('Video recording is not supported in this browser.');
        return;
      }
      mediaRecorder.ondataavailable = (event) => {
        if (event.data.size > 0) recordedChunks.push(event.data);
      };
      mediaRecorder.onstop = () => {
        const blob = new Blob(recordedChunks, { type: 'video/webm' });
        const videoUrl = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = videoUrl;
        link.download = 'video.webm';
        link.click();
      };
      mediaRecorder.start();
      recordVideoButton.style.display = 'none';
      stopVideoButton.style.display = 'block';
    });

    // Stop recording the video
    stopVideoButton.addEventListener('click', () => {
      if(mediaRecorder && mediaRecorder.state !== 'inactive') {
        mediaRecorder.stop();
      }
      recordVideoButton.style.display = 'block';
      stopVideoButton.style.display = 'none';
    });

    // Close the camera section and return to features
    function closeCamera() {
      if (mediaStream) {
        mediaStream.getTracks().forEach(track => track.stop());
      }
      document.getElementById('camera').style.display = 'none';
      document.getElementById('features').style.display = 'block';
    }

    /* --------------------- Chat Feature --------------------- */

    // Send a chat message to the backend and update the chat window
    async function sendMessage() {
      const message = chatInput.value.trim();
      if (!message) return;
      try {
        const response = await fetch('http://localhost:3000/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: loggedInUserEmail, message })
        });
        const data = await response.json();
        if (response.status === 201) {
          const messageElement = document.createElement('div');
          messageElement.className = 'chat-message';
          messageElement.textContent = `${loggedInUserEmail}: ${message}`;
          chatMessages.appendChild(messageElement);
          chatInput.value = '';
          chatMessages.scrollTop = chatMessages.scrollHeight;
        } else {
          alert(data.message);
        }
      } catch (error) {
        console.error('Send message error:', error);
        alert('Failed to send message.');
      }
    }

    // Fetch all chat messages from the backend and display them
    async function fetchChatMessages() {
      try {
        const response = await fetch('http://localhost:3000/chat');
        const data = await response.json();
        chatMessages.innerHTML = '';
        data.forEach(chat => {
          const messageElement = document.createElement('div');
          messageElement.className = 'chat-message';
          messageElement.textContent = `${chat.email}: ${chat.message}`;
          chatMessages.appendChild(messageElement);
        });
        chatMessages.scrollTop = chatMessages.scrollHeight;
      } catch (error) {
        console.error('Fetch chat messages error:', error);
      }
    }

    // Open the chat section and load messages
    function openChat() {
      document.getElementById('features').style.display = 'none';
      document.getElementById('chat').style.display = 'flex';
      fetchChatMessages();
    }

    // Close the chat section and return to features
    function closeChat() {
      document.getElementById('chat').style.display = 'none';
      document.getElementById('features').style.display = 'block';
    }

    sendChatBtn.addEventListener('click', sendMessage);
    chatInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });

    /* --------------------- Logout --------------------- */

    function logout() {
      loggedInUserEmail = '';
      userEmailEl.textContent = '';
      authSection.style.display = 'flex';
      appContent.style.display = 'none';
      alert('Logged out successfully.');
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=0.8" />
  <title>TEDPOLE - Premium Clothing & Accessories</title>
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
  <!-- QR Code Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <!-- html2canvas Library for Download Functionality -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <!-- AOS Animation Library -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <style>
    /* Base theme */
    :root {
      --primary-color: #2a5298;
      --secondary-color: #ffdd57;
      --accent-color: #e1306c;
      --dark-color: #343a40;
      --light-color: #f8f9fa;
      --success-color: #28a745;
      --danger-color: #dc3545;
      --warning-color: #ffc107;
      --info-color: #17a2b8;
    }
    
    * {
      scroll-behavior: smooth;
    }
    
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f6f9fc, #e9f0f8), url('https://www.toptal.com/designers/subtlepatterns/uploads/double-bubble-outline.png');
      background-size: cover;
      margin-bottom: 70px;
      padding-top: 60px;
    }
    
    /* Header Styles */
    header {
      background: white;
      color: black;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }
    
    .scrolled-header {
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      padding: 5px 0;
    }
    
    header h1, header .profile-name { color: black; }
    
    /* Button Styles */
    .btn-primary { 
      background-color: var(--primary-color); 
      border-color: var(--primary-color); 
    }
    .btn-primary:hover {
      background-color: #1a3a6b;
      border-color: #1a3a6b;
    }
    
    .btn-secondary {
      background-color: var(--dark-color);
      border-color: var(--dark-color);
    }
    
    .btn-danger { 
      background-color: var(--danger-color); 
      border-color: var(--danger-color); 
    }
    
    .btn-info { 
      background-color: var(--info-color); 
      border-color: var(--info-color); 
    }
    
    .btn-warning {
      background-color: var(--warning-color);
      border-color: var(--warning-color);
      color: var(--dark-color);
    }
    
    .bg-light { background-color: var(--light-color) !important; }
    
    /* Animation Styles */
    .fade-in { 
      animation: fadeIn 0.5s ease-in-out; 
    }
    
    @keyframes fadeIn { 
      from { opacity: 0; } 
      to { opacity: 1; } 
    }
    
    .slide-up {
      animation: slideUp 0.5s ease-out;
    }
    
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    /* General Styling */
    .hero { 
      padding: 20px 0; 
      background: rgba(255,255,255,0.9);
      border-radius: 10px;
      margin: 20px 0;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .hero h2 { 
      font-size: 1.75rem; 
      margin-bottom: 0.5rem; 
      color: var(--primary-color);
    }
    
    .product-highlight img, .category-item img { 
      border-radius: 5px; 
      transition: transform 0.3s ease;
    }
    
    .product-highlight img:hover, .category-item img:hover {
      transform: scale(1.02);
    }
    
    header h1 { 
      font-size: 1.125rem; 
      font-weight: 600; 
    }
    
    header .profile-name { 
      font-size: 1rem; 
      margin-left: 10px; 
    }
    
    /* Header Navigation */
    nav a, nav button { 
      font-size: 0.9rem; 
      padding: 5px 1px; 
      color: black; 
      text-decoration: none; 
      background: none; 
      border: none; 
    }
    
    nav a:hover, nav button:hover { 
      color: #333; 
    }
    
    nav .btn i { 
      font-size: 1.75rem; 
      transition: color 0.3s ease; 
    }
    
    nav .btn i:hover { 
      color: var(--secondary-color); 
    }
    
    .header-nav { 
      display: flex; 
      gap: 0.5rem; 
      align-items: center; 
    }
    
    #notificationButton { 
      font-size: 1.75rem; 
      position: relative;
    }
    
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background-color: var(--danger-color);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: bold;
    }
    
    /* Improved Icon Appearance */
    button[data-bs-target="#menuCanvas"] i {
      font-size: 2rem;
      color: var(--primary-color);
    }
    
    .btn {
      border-width: 1px;
      transition: all 0.3s ease;
    }
    
    nav .btn i, .footer-nav .nav-link i {
      font-size: 1.75rem;
      color: var(--primary-color);
    }
    
    nav .btn i:hover, .footer-nav .nav-link:hover i {
      color: var(--secondary-color);
    }
    
    /* Category Section */
    .category-item { 
      text-align: center; 
      cursor: pointer; 
      transition: all 0.3s ease;
      padding: 15px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .category-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    
    .category-item h4 { 
      margin-top: 10px; 
      font-size: 1.2rem; 
      color: var(--primary-color);
    }
    
    /* Section Visibility */
    .section { 
      display: none; 
      min-height: calc(100vh - 120px);
    }
    
    .active-section { 
      display: block; 
      animation: fadeIn 0.5s ease-in-out;
    }
    
    /* Offcanvas Menu */
    .offcanvas { 
      background: var(--light-color); 
      border-right: 4px solid var(--primary-color); 
      width: 300px !important;
    }
    
    .offcanvas-header { 
      background: var(--primary-color); 
      color: #fff; 
    }
    
    .offcanvas-header .btn-close { 
      filter: invert(1); 
    }
    
    .custom-menu-item { 
      padding: 12px 15px; 
      font-size: 1rem; 
      border-bottom: 1px solid #ddd; 
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
    }
    
    .custom-menu-item:hover { 
      background: #e9f0fa; 
      padding-left: 20px;
    }
    
    .custom-menu-item i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }
    
    #menuAccountDetails { 
      padding: 15px; 
      background: #fff; 
      border-bottom: 2px solid var(--primary-color); 
      border-radius: 5px; 
      text-align: center; 
      margin-bottom: 10px; 
    }
    
    /* Popup Modal */
    .popup-modal-content { 
      border: 3px solid var(--primary-color); 
      border-radius: 12px; 
      background: linear-gradient(135deg, #fff, #f0f8ff); 
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.15); 
    }
    
    .popup-modal-header, .popup-modal-footer { 
      border: none; 
    }
    
    .popup-modal-body { 
      text-align: center; 
      font-size: 1.3rem; 
      font-weight: 600; 
      padding: 20px; 
    }
    
    /* Toast Container */
    #toastContainer { 
      position: fixed; 
      top: 1rem; 
      right: 1rem; 
      z-index: 1100; 
    }
    
   /* Product Detail Styling */
   .product-detail-img { 
    max-height: 400px; 
    object-fit: contain; 
    margin-bottom: 20px; 
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    cursor: zoom-in;
    transition: all 0.3s ease;
  }
  
  .product-detail-img:hover {
    transform: scale(1.02);
  }
    
    /* Footer Navigation - Modified Padding */
    .footer-nav {
      background: white;
      border-top: 1px solid #ddd;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 1200;
      padding: 1px 0; 
    }
    .footer-nav .nav-item { text-align: center; flex: 1; position: relative; }
    .footer-nav .nav-link { color: black; font-size: 1rem; transition: color 0.3s ease; position: relative; }
    .footer-nav .nav-text { font-size: 0.75rem; color: black; }
    .footer-nav .nav-link:hover, .footer-nav .nav-link:hover .nav-text { color: #ffdd57; }
    .footer-nav .badge { position: absolute; top: -5px; right: -10px; background-color: #ffdd57; color: #000; font-size: 0.6rem; padding: 2px 5px; border-radius: 50%; }
    
    /* Wishlist Button Styling */
    .wishlist-btn { 
      background: rgba(255, 255, 255, 0.8); 
      border-radius: 50%; 
      border: none; 
      padding: 8px;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    
    .wishlist-btn:hover {
      background: rgba(255, 255, 255, 1);
      transform: scale(1.1);
    }
    
    /* Dynamic Hover Effects */
    .btn:hover { 
      transform: translateY(-2px); 
      box-shadow: 0 5px 10px rgba(0,0,0,0.1);
    }
    
    .card:hover { 
      box-shadow: 0 10px 20px rgba(0,0,0,0.1); 
      transform: translateY(-5px);
    }
    
    .card {
      transition: all 0.3s ease;
      border: none;
      overflow: hidden;
    }
    
    /* Updated Track Bar Styling */
    .track-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 20px 0;
    }
    
    .track-step {
      text-align: center;
      position: relative;
      flex: 1;
    }
    
    .track-step:not(:last-child):after {
      content: '';
      position: absolute;
      top: 15px;
      left: 50%;
      width: 100%;
      height: 2px;
      background-color: #ccc;
      z-index: -1;
    }
    
    .track-bar.received .track-step:not(:last-child):after { background-color: var(--success-color); }
    .track-bar.cancelled .track-step:not(:last-child):after { background-color: var(--danger-color); }
    
    .track-step span {
      display: block;
      width: 30px;
      height: 30px;
      line-height: 30px;
      border-radius: 50%;
      background-color: #ccc;
      color: #fff;
      margin: 0 auto 5px;
    }
    
    .track-step.active span { background-color: var(--success-color); }
    .track-step.cancelled span { background-color: var(--danger-color); }
    
    .color-thumbnail { 
      display: inline-block; 
      margin: 5px; 
      border: 2px solid transparent; 
      cursor: pointer; 
      border-radius: 50%;
      overflow: hidden;
      width: 40px;
      height: 40px;
      transition: all 0.3s ease;
    }
    
    .color-thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .color-thumbnail.selected { 
      border-color: #000; 
      transform: scale(1.1);
    }
    
    /* Product Images Modal Styling */
    #productImagesModal .modal-body { 
      overflow: auto; 
      max-height: 80vh; 
      text-align: center; 
      padding: 0;
    }
    
    #productCarousel img { 
      max-height: 500px; 
      object-fit: contain; 
    }
    
    .carousel-control-prev, .carousel-control-next {
      background-color: rgba(0,0,0,0.2);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      top: 50%;
      transform: translateY(-50%);
      opacity: 0.8;
    }
    
    .carousel-control-prev:hover, .carousel-control-next:hover {
      background-color: rgba(0,0,0,0.4);
    }
    
    .carousel-control-prev {
      left: 15px;
    }
    
    .carousel-control-next {
      right: 15px;
    }
    
    /* Splash Screen */
    .splash-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: #f6f9fc;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      transition: opacity 0.5s ease;
    }
    
    .splash-screen img.logo {
      max-width: 200px;
      width: 50%;
      height: auto;
      margin-bottom: 20px;
      animation: zoomIn 1s ease-in;
    }
    
    .splash-screen h1 {
      font-size: 2.5rem;
      color: var(--primary-color);
      font-weight: bold;
      animation: slideIn 1s ease-in;
    }
    
    @keyframes zoomIn {
      from { transform: scale(0); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    @keyframes slideIn {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    /* Product Card Hover Effect */
    .product-card {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      height: 100%;
      display: flex;
      flex-direction: column;
    }
    
    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    
    .product-card .card-body {
      flex-grow: 1;
    }
    
     /* Recommendations Section */
     .recommendations-section {
        margin-top: 40px;
        padding-top: 20px;
        border-top: 1px solid #eee;
      }
      
      .recommendations-title {
        font-size: 1.5rem;
        margin-bottom: 20px;
        text-align: center;
        color: #2a5298;
      }
      
      .recommendation-card {
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 20px;
      }
      
      .recommendation-card:hover {
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        transform: translateY(-5px);
      }
      
      .recommendation-img {
        height: 200px;
        object-fit: cover;
        border-radius: 5px;
      }
      
      .recommendation-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: #ffdd57;
        color: #000;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
      }
     /* Enhanced Search Section */
     .search-container {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: space-between;
        max-width: 800px;
        margin: 0 auto;
        padding: 10px;
        background: white;
        border-radius: 25px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      }
      
      #searchBarContainer {
        flex-grow: 1;
        margin-left: 10px; /* Existing spacing from search icon */
        margin-right: 20px; /* New: Increased spacing before voice search button */
      }
      
      .search-container input {
        border: none;
        outline: none;
        flex-grow: 1;
        padding: 5px; /* Reduced from 10px to match container padding */
        font-size: 0.9rem; /* Slightly smaller font size, down from 1rem */
      }
      
      .search-suggestions {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid #ddd;
        border-top: none;
        border-radius: 0 0 25px 25px;
        z-index: 1000;
        max-height: 300px;
        overflow-y: auto;
        display: none;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      }
      
      .search-suggestion-item {
        padding: 10px 15px;
        cursor: pointer;
        border-bottom: 1px solid #eee;
        transition: background-color 0.2s;
        display: flex;
        align-items: center;
      }
      
      .search-suggestion-item:hover {
        background-color: #f8f9fa;
      }
      
      .search-suggestion-item img {
        width: 40px;
        height: 40px;
        object-fit: cover;
        margin-right: 10px;
        border-radius: 5px;
      }
      
      .search-history {
        margin-top: 15px;
        padding: 10px;
      }
      
      .search-history-item {
        display: inline-block;
        margin-right: 8px;
        margin-bottom: 8px;
        padding: 5px 10px;
        background: #f1f1f1;
        border-radius: 20px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.2s;
      }
      
      .search-history-item:hover {
        background: #e9ecef;
      }
      
     /* Draggable Filter Button */
     .draggable-filter {
      position: fixed;
      bottom: 140px;
      right: 20px;
      width: 50px;
      height: 50px;
      cursor: move;
      z-index: 1001;
      background-color: var(--primary-color);
      color: white;
      border-radius: 50%;

      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    
    .draggable-filter:hover {
      background-color: #1a3a6b;
    }
    /* Enhanced Orders Section */
    .order-card {
      transition: all 0.3s ease;
      margin-bottom: 20px;
      cursor: pointer;
    }
    
    .order-card:hover {
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      transform: translateY(-3px);
    }
    
    .order-status-badge {
      font-size: 0.8rem;
      padding: 5px 10px;
      border-radius: 20px;
    }
    
    .order-status-confirmed {
      background-color: var(--primary-color);
      color: white;
    }
    
    .order-status-shipped {
      background-color: var(--info-color);
      color: white;
    }
    
    .order-status-delivered {
      background-color: var(--success-color);
      color: white;
    }
    
    .order-status-cancelled {
      background-color: var(--danger-color);
      color: white;
    }
    
    .order-actions {
      margin-top: 15px;
    }
    
    .order-detail-section {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 15px;
    }
    
    .order-timeline {
      position: relative;
      padding-left: 30px;
      margin-top: 20px;
    }
    
    .order-timeline::before {
      content: '';
      position: absolute;
      left: 10px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: #dee2e6;
    }
    
    .timeline-item {
      position: relative;
      padding-bottom: 20px;
    }
    
    .timeline-item:last-child {
      padding-bottom: 0;
    }
    
    .timeline-item::before {
      content: '';
      position: absolute;
      left: -30px;
      top: 0;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #6c757d;
      border: 3px solid #fff;
    }
    
    .timeline-item.active::before {
      background: var(--success-color);
    }
    
    .timeline-date {
      font-size: 0.8rem;
      color: #6c757d;
    }
    
    /* Rating Stars */
    .rating-stars {
      unicode-bidi: bidi-override;
      direction: rtl;
      font-size: 1.5rem;
    }
    
    .rating-stars > span {
      display: inline-block;
      position: relative;
      width: 1.1em;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .rating-stars > span:hover:before,
    .rating-stars > span:hover ~ span:before {
      content: "★";
      position: absolute;
      color: gold;
    }
    
    /* Filter Chips */
    .filter-chip {
      display: inline-block;
      padding: 5px 10px;
      margin-right: 8px;
      margin-bottom: 8px;
      background: #e9ecef;
      border-radius: 20px;
      font-size: 0.9rem;
    }
    
    .filter-chip .remove-filter {
      margin-left: 5px;
      cursor: pointer;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .order-card .card-body > div {
        margin-bottom: 15px;
      }
      
      .footer-nav .nav-link {
        font-size: 0.8rem;
      }
      
      .footer-nav .nav-text {
        font-size: 0.65rem;
      }
      
      .category-item h4 {
        font-size: 1rem;
      }
    }
    
    .order-card-image {
      height: 100px;
      width: 100px;
      object-fit: cover;
      border-radius: 5px;
      margin-right: 15px;
    }
    
    .delete-order-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      color: var(--danger-color);
      cursor: pointer;
      transition: transform 0.2s;
      background: rgba(255,255,255,0.8);
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .delete-order-btn:hover {
      transform: scale(1.2);
      background: rgba(255,255,255,1);
    }
    
    .cancelled-order {
      opacity: 0.8;
      background-color: #ffe6e6;
      border-left: 4px solid var(--danger-color);
    }
    
    /* Size Selection Buttons */
    .size-btn {
      margin: 3px;
      min-width: 40px;
      transition: all 0.2s;
    }
    
    .size-btn.active {
      background-color: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }
    
    /* Color Selection */
    .color-selection {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 10px 0;
    }
    
    /* Quantity Selector */
    .quantity-selector {
      display: flex;
      align-items: center;
      margin: 15px 0;
    }
    
    .quantity-btn {
      width: 30px;
      height: 30px;
      border: 1px solid #ddd;
      background: #f8f9fa;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
    }
    
    .quantity-input {
      width: 50px;
      text-align: center;
      height: 30px;
      border: 1px solid #ddd;
      border-left: none;
      border-right: none;
    }
    
    /* Loading Spinner */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Back to Top Button */
    .back-to-top {
      position: fixed;
      bottom: 80px;
      right: 20px;
      width: 50px;
      height: 50px;
      background-color: var(--primary-color);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    
    .back-to-top.visible {
      opacity: 1;
      visibility: visible;
    }
    
    .back-to-top:hover {
      background-color: #1a3a6b;
      transform: translateY(-3px);
    }
    
    /* Print Styles */
    @media print {
      body * {
        visibility: hidden;
      }
      .print-selected, .print-selected * {
        visibility: visible;
      }
      .print-selected {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }
    }
    
    .print-mode .order-card {
      box-shadow: none;
      border: none;
    }
    
    /* Dark Mode Toggle */
    .dark-mode-toggle {
      position: fixed;
      bottom: 140px;
      right: 20px;
      width: 50px;
      height: 50px;
      background-color: var(--dark-color);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    
    /* Mobile Menu Toggle Animation */
    .navbar-toggler {
      transition: all 0.3s ease;
    }
    
    .navbar-toggler:focus {
      box-shadow: none;
    }
    
    .navbar-toggler.collapsed .navbar-toggler-icon {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%280, 0, 0, 0.55%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
    }
    
    @keyframes slideDown {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
     /* Dark Mode Toggle */
     .dark-mode-toggle {
        position: fixed;
        bottom: 140px;
        right: 20px;
        width: 50px;
        height: 50px;
        background-color: var(--dark-color);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      }
      
      /* Mobile Menu Toggle Animation */
      .navbar-toggler {
        transition: all 0.3s ease;
      }
      
      .navbar-toggler:focus {
        box-shadow: none;
      }
      
      .navbar-toggler.collapsed .navbar-toggler-icon {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%280, 0, 0, 0.55%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
      }
      
    /* Product Badges */
    .product-badge {
      position: absolute;
      top: 10px;
      left: 10px;
      padding: 5px 10px;
      border-radius: 3px;
      font-size: 0.8rem;
      font-weight: bold;
      color: white;
    }
    
    .badge-new {
      background-color: var(--success-color);
    }
    
    .badge-sale {
      background-color: var(--danger-color);
    }
    
    .badge-featured {
      background-color: var(--accent-color);
    }
    /* Mobile Optimization */
    @media (max-width: 768px) {
      body {
        padding-bottom: 60px;
      }

      .hero h2 {
        font-size: 1.5rem;
      }

      header h1 {
        font-size: 1rem;
        max-width: 120px;
      }

      .footer-nav {
        padding: 2px 0;
      }

      .footer-nav .nav-link {
        padding: 2px;
      }

      .footer-nav .nav-text {
        font-size: 0.6rem;
      }
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-color);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 3px;
    }
    /* Enhanced Toast Styling */
#toastContainer {
  position: fixed;
  top: 1rem;
  right: 1rem;
  z-index: 1100;
  min-width: 300px;
  max-width: 400px;
}

.toast {
  margin-bottom: 0.5rem;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  opacity: 0;
  transform: translateY(-20px);
  transition: opacity 0.3s ease, transform 0.3s ease;
}

.toast.show {
  opacity: 1;
  transform: translateY(0);
}

.toast-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.5rem 1rem;
  border-bottom: 1px solid rgba(255, 255, 255, 0.2);
}

.toast-header .toast-title {
  margin: 0;
  font-size: 1rem;
  font-weight: 600;
}

.toast-body {
  padding: 1rem;
  font-size: 0.95rem;
}

.toast .notification-icon {
  margin-right: 0.5rem;
  font-size: 1.2rem;
}

/* Type-specific colors */
.bg-success { background-color: var(--success-color) !important; }
.bg-danger { background-color: var(--danger-color) !important; }
.bg-warning { background-color: var(--warning-color) !important; }
.bg-info { background-color: var(--info-color) !important; }
  </style>
</head>
<body>
  <!-- Toast Container -->
  <div id="toastContainer"></div>
 <!-- Dark Mode Toggle -->
 <div class="dark-mode-toggle" onclick="toggleDarkMode()">
    <i class="bi bi-moon"></i>
  </div>
  <!-- Splash Screen -->
  <div id="splashScreen" class="splash-screen" role="dialog" aria-label="Welcome to TEDPOLE">
    <img src="https://via.placeholder.com/200x200?text=TEDPOLE" alt="TEDPOLE Logo" class="logo">
    <h1>TEDPOLE</h1>
  </div>

  <!-- Popup Message Modal -->
  <div class="modal fade" id="popupMessageModal" tabindex="-1" aria-labelledby="popupMessageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content popup-modal-content">
        <div class="modal-header popup-modal-header">
          <h5 class="modal-title" id="popupMessageModalLabel">Notification</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body popup-modal-body" id="popupMessageContent"></div>
        <div class="modal-footer popup-modal-footer" style="justify-content: center;">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Okay</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Notifications Section -->
  <div id="notificationsSection" class="section">
    <header class="bg-light py-3 border-bottom">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')"><i class="far fa-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">Notifications</h1>
        <button class="btn btn-sm btn-danger" onclick="clearNotifications()">Clear All</button>
      </div>
    </header>
    <div class="container my-4" id="notificationsContent"></div>
  </div>

<!-- Offcanvas Menu -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="menuCanvas" aria-labelledby="menuCanvasLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="menuCanvasLabel">Menu</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div id="menuAccountDetails">
      <i class="bi bi-person-circle me-2"></i><span id="menuAccountText">Welcome Guest</span>
    </div>
    <ul class="list-unstyled">
      <li class="custom-menu-item" onclick="hideMenu(); showSection('ordersSection');"><i class="bi bi-receipt me-2"></i> My Orders</li>
      <li id="sellerDashboardMenuItem" class="custom-menu-item" onclick="hideMenu(); showSection('sellerDashboard');" style="display: none;"><i class="bi bi-speedometer me-2"></i> Seller Dashboard</li>
      <li id="ownerDashboardMenuItem" class="custom-menu-item" onclick="hideMenu(); showSection('ownerDashboard');" style="display: none;"><i class="bi bi-graph-up me-2"></i> Owner Dashboard</li>
      <li class="custom-menu-item" onclick="hideMenu(); showSection('aboutSection');"><i class="bi bi-info-circle me-2"></i> About Us</li>
      <li class="custom-menu-item" onclick="hideMenu(); showSection('contactSection');"><i class="bi bi-envelope me-2"></i> Contact Us</li>
      <li class="custom-menu-item" onclick="hideMenu(); showSection('couponsSection');"><i class="bi bi-tag me-2"></i> Coupons</li>
      <li class="custom-menu-item" onclick="hideMenu(); showSection('offerZoneSection');"><i class="bi bi-star me-2"></i> Offer Zone</li>
      <li class="custom-menu-item" onclick="hideMenu(); showSection('helpSection');"><i class="bi bi-question-circle me-2"></i> Help Line</li>
    </ul>
    <div id="menuSocialSection" class="mt-3 text-center">
      <a href="https://www.instagram.com/tedpole.in" target="_blank" class="mx-2"><i class="bi bi-instagram" style="color:#E1306C;"></i></a>
      <a href="https://x.com/TedpoleIn" target="_blank" class="mx-2"><i class="bi bi-twitter" style="color:#1DA1F2;"></i></a>
      <a href="https://www.linkedin.com/in/yourprofile" target="_blank" class="mx-2"><i class="bi bi-linkedin" style="color:#0077B5;"></i></a>
    </div>
  </div>

   <!-- Home Section -->
   <div id="homeSection" class="section active-section fade-in">
    <header class="py-3 border-bottom">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn text-dark" data-bs-toggle="offcanvas" data-bs-target="#menuCanvas" aria-controls="menuCanvas" aria-label="Toggle Menu">
          <i class="bi bi-list"></i>
        </button>
        <h1 class="h5 mb-0 text-dark">TEDPOLE <span id="headerProfile" class="profile-name"></span></h1>
        <nav class="header-nav">
          <button class="btn text-dark" id="notificationButton" aria-label="Notifications">
            <i class="bi bi-bell"></i>
          </button>
          <button class="btn text-dark" id="accountButton" aria-label="Account">
            <i class="bi bi-person"></i>
          </button>
        </nav>
      </div>
    </header>
    <section class="hero text-center">
      <div class="container">
        <h2 class="mt-4">Welcome to TEDPOLE</h2>
        <p>Your destination for premium clothes.</p>
        <button class="btn btn-dark mt-2" id="shopNowButton" onclick="showSection('shopSection')" aria-label="Shop Now"><i class="fas fa-cart-check"></i> Shop Now</button>
      </div>
    </section>
    <section class="product-highlight py-5">
      <div class="container">
        <div id="productHighlightCarousel" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-indicators">
            <button type="button" data-bs-target="#productHighlightCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
            <button type="button" data-bs-target="#productHighlightCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
            <button type="button" data-bs-target="#productHighlightCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
          </div>
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img src="https://i.pinimg.com/474x/d0/fd/28/d0fd28fc614775339300cf6f2ab043d2.jpg" class="d-block w-100" alt="Product Highlight 1">
              <div class="carousel-caption d-none d-md-block">
                <h5>Luxury in Every Stitch</h5>
                <p>Clothing is a form of self-expression.</p>
              </div>
            </div>
            <div class="carousel-item">
              <img src="https://i.pinimg.com/474x/1e/d0/ed/1ed0ede5c364f2c8959976120f65271f.jpg" class="d-block w-100" alt="Product Highlight 2">
              <div class="carousel-caption d-none d-md-block">
                <h5>Trendy Men's Wear</h5>
                <p>Explore our latest collection.</p>
              </div>
            </div>
            <div class="carousel-item">
              <img src="https://i.pinimg.com/474x/f4/96/20/f496209cab01d85a80a84b785068c007.jpg" class="d-block w-100" alt="Product Highlight 3">
              <div class="carousel-caption d-none d-md-block">
                <h5>Stylish Accessories</h5>
                <p>Complete your look.</p>
              </div>
            </div>
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#productHighlightCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#productHighlightCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      </div>
    </section>
    <section class="categories py-5 bg-light">
      <div class="container text-center">
        <h2><i class="fas fa-columns-gap"></i> Shop by Categories</h2>
        <div class="row mt-4">
          <div class="col-md-6">
            <div class="category-item" onclick="showSection('menswearSection')">
              <img src="https://i.pinimg.com/474x/1e/d0/ed/1ed0ede5c364f2c8959976120f65271f.jpg" class="img-fluid" alt="Men's Wear" />
              <h4 class="mt-3"><i class="fas fa-people-group"></i> MEN'S WEAR</h4>
            </div>
          </div>
          <div class="col-md-6">
            <div class="category-item" onclick="showSection('accessoriesSection')">
              <img src="https://i.pinimg.com/474x/f4/96/20/f496209cab01d85a80a84b785068c007.jpg" class="img-fluid" alt="Accessories" />
              <h4 class="mt-3"><i class="fas fa-watch"></i> ACCESSORIES</h4>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- About Us Section -->
  <div id="aboutSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">About Us</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4">
      <p>We are a premium clothing and accessories store dedicated to providing high-quality products and exceptional customer service. Our passion is to make you look and feel your best.</p>
    </div>
  </div>

  <!-- Contact Us Section -->
  <div id="contactSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">Contact Us</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4">
      <form id="contactForm">
        <div class="mb-3">
          <label for="contactName" class="form-label">Name</label>
          <input type="text" class="form-control" id="contactName" placeholder="Your Name" required aria-label="Your Name" />
        </div>
        <div class="mb-3">
          <label for="contactEmail" class="form-label">Email Address</label>
          <input type="email" class="form-control" id="contactEmail" placeholder="Your Email" required aria-label="Your Email" />
        </div>
        <div class="mb-3">
          <label for="contactQuestion" class="form-label">Question</label>
          <textarea class="form-control" id="contactQuestion" placeholder="Your Question" required aria-label="Your Question"></textarea>
        </div>
        <button type="submit" class="btn btn-primary" aria-label="Send Message">Send</button>
      </form>
    </div>
  </div>

  <!-- Coupons Section -->
  <div id="couponsSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">Coupons</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4">
      <p>No coupons available at the moment. Check back later!</p>
    </div>
  </div>

  <!-- Offer Zone Section -->
  <div id="offerZoneSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">Offer Zone</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4">
      <p>Explore our exclusive offers and deals. Stay tuned for upcoming discounts!</p>
    </div>
  </div>

  <!-- Help Line Section -->
  <div id="helpSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">Help Line</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4">
      <p>For assistance, please call <strong>+91 7661838006</strong> or email us at <strong>tedpole.in@gmail.com</strong>.</p>
    </div>
  </div>

  <!-- Wishlist Section -->
  <div id="wishlistSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">Wishlist</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4" id="wishlistContainer"></div>
  </div>

  <!-- Categories Section -->
  <div id="categoriesSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">Categories</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4">
      <div class="row">
        <div class="col-6 mb-4">
          <div class="card shadow-sm" onclick="showSection('menswearSection')" style="cursor:pointer;">
            <img src="https://i.pinimg.com/474x/1e/d0/ed/1ed0ede5c364f2c8959976120f65271f.jpg" class="card-img-top" alt="Men's Wear" />
            <div class="card-body text-center">
              <h5 class="card-title">MEN'S WEAR</h5>
            </div>
          </div>
        </div>
        <div class="col-6 mb-4">
          <div class="card shadow-sm" onclick="showSection('accessoriesSection')" style="cursor:pointer;">
            <img src="https://i.pinimg.com/474x/f4/96/20/f496209cab01d85a80a84b785068c007.jpg" class="card-img-top" alt="Accessories" />
            <div class="card-body text-center">
              <h5 class="card-title">ACCESSORIES</h5>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Seller Dashboard Section -->
  <div id="sellerDashboard" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">Seller Dashboard</h1>
        <div></div>
      </div>
    </header>
    <div class="container" id="sellerDashboardContent"></div>
  </div>

  <!-- Owner Dashboard Section -->
  <div id="ownerDashboard" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">Owner Dashboard</h1>
        <button class="btn btn-primary" onclick="updateOwnerDashboard()" aria-label="Refresh Dashboard"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
      </div>
    </header>
    <div class="container my-4">
      <h2>Website Statistics</h2>
      <div class="row mt-4">
        <div class="col-md-4">
          <div class="card text-center shadow-sm">
            <div class="card-body">
              <h5 class="card-title">Total Members</h5>
              <p class="card-text display-4" id="totalMembers">0</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-center shadow-sm">
            <div class="card-body">
              <h5 class="card-title">Active Users</h5>
              <p class="card-text display-4" id="activeUsers">0</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-center shadow-sm">
            <div class="card-body">
              <h5 class="card-title">Live Users</h5>
              <p class="card-text display-4" id="liveUsers">0</p>
            </div>
          </div>
        </div>
      </div>
      <h2 class="mt-5">Order Statistics</h2>
      <div class="row mt-4">
        <div class="col-md-3">
          <div class="card text-center shadow-sm">
            <div class="card-body">
              <h5 class="card-title">Total Orders</h5>
              <p class="card-text display-4" id="totalOrders">0</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center shadow-sm">
            <div class="card-body">
              <h5 class="card-title">Active Orders</h5>
              <p class="card-text display-4" id="activeOrders">0</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center shadow-sm">
            <div class="card-body">
              <h5 class="card-title">Cancelled Orders</h5>
              <p class="card-text display-4" id="cancelledOrders">0</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center shadow-sm">
            <div class="card-body">
              <h5 class="card-title">Received Orders</h5>
              <p class="card-text display-4" id="receivedOrders">0</p>
            </div>
          </div>
        </div>
      </div>
      <h2 class="mt-5">Order Details</h2>
      <div id="orderDetailsContainer" class="mt-4"></div>
      <h2 class="mt-5">User Locations</h2>
      <div id="userLocationsContainer" class="mt-4"></div>
    </div>
  </div>

 <!-- Updated Search Section -->
 <div id="searchSection" class="section fade-in" style="position: relative;">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home">
          <i class="bi bi-arrow-left"></i> Home
        </button>
        <h1 class="h5 mb-0">Search Products</h1>
        <div></div>
      </div>
    </header>
    <div class="container mt-5 my-4">
        <div class="search-container mb-4">
            <button class="btn btn-dark" type="button" id="searchSectionButton" aria-label="Search" onclick="toggleSearchBar()">
              <i class="bi bi-search"></i>
            </button>
            <div id="searchBarContainer" style="display: none; flex-grow: 1; margin-left: 10px;">
              <input type="text" class="form-control" placeholder="Search for shirts, pants, accessories..." 
                     id="searchSectionInput" autocomplete="off" aria-label="Search for Products"
                     onkeyup="handleSearchInput()">
            </div>
            <button class="btn btn-outline-secondary" type="button" id="voiceSearchButton" aria-label="Search by Voice" onclick="startVoiceSearch()">
              <i class="bi bi-mic"></i>
            </button>
            <div id="searchSuggestions" class="search-suggestions"></div>
          </div>
      <div class="search-results-container">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 id="searchResultsCount">0 products found</h5>
          <div id="searchActiveFilters"></div>
        </div>
        <div class="row" id="searchResultsContainer"></div>
      </div>
      <button class="draggable-filter" data-bs-toggle="modal" data-bs-target="#searchFilterModal" aria-label="Filter Search">
        <i class="bi bi-funnel"></i>
      </button>
    </div>
  </div>
 <!-- Search Filter Modal -->
 <div class="modal fade" id="searchFilterModal" tabindex="-1" aria-labelledby="searchFilterModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="searchFilterModalLabel">Filter Products</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row g-3">
          <div class="col-md-6">
            <label for="searchCategory" class="form-label">Category</label>
            <select id="searchCategory" class="form-select">
              <option value="">All Categories</option>
              <option value="Men's Wear">Men's Wear</option>
              <option value="Accessories">Accessories</option>
            </select>
          </div>
          <div class="col-md-6">
            <label for="searchPrice" class="form-label">Price Range</label>
            <select id="searchPrice" class="form-select">
              <option value="">All Prices</option>
              <option value="0-100">Under ₹100</option>
              <option value="100-200">₹100 - ₹200</option>
              <option value="200-300">₹200 - ₹300</option>
              <option value="300-500">₹300 - ₹500</option>
              <option value="500">Above ₹500</option>
            </select>
          </div>
          <div class="col-md-6">
            <label for="searchRating" class="form-label">Minimum Rating</label>
            <select id="searchRating" class="form-select">
              <option value="">Any Rating</option>
              <option value="4">4+ Stars</option>
              <option value="3">3+ Stars</option>
              <option value="2">2+ Stars</option>
              <option value="1">1+ Star</option>
            </select>
          </div>
          <div class="col-md-6">
            <label for="searchSort" class="form-label">Sort By</label>
            <select id="searchSort" class="form-select">
              <option value="relevance">Relevance</option>
              <option value="price-low">Price: Low to High</option>
              <option value="price-high">Price: High to Low</option>
              <option value="rating">Highest Rated</option>
              <option value="newest">Newest Arrivals</option>
            </select>
          </div>
          <div class="col-md-6">
            <label for="searchSize" class="form-label">Size</label>
            <select id="searchSize" class="form-select">
              <option value="">All Sizes</option>
              <option value="S">S</option>
              <option value="M">M</option>
              <option value="L">L</option>
              <option value="XL">XL</option>
              <option value="32">32</option>
              <option value="34">34</option>
              <option value="36">36</option>
              <option value="One Size">One Size</option>
            </select>
          </div>
          <div class="col-md-6">
            <label for="searchColor" class="form-label">Color</label>
            <select id="searchColor" class="form-select">
              <option value="">All Colors</option>
              <option value="Blue">Blue</option>
              <option value="Red">Red</option>
              <option value="Black">Black</option>
              <option value="Brown">Brown</option>
              <option value="White">White</option>
              <option value="Silver">Silver</option>
            </select>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" onclick="clearSearchFilters()" data-bs-dismiss="modal">Clear Filters</button>
        <button type="button" class="btn btn-primary" onclick="performSearch()" data-bs-dismiss="modal">Apply Filters</button>
      </div>
    </div>
  </div>
</div>

  <!-- Login Section -->
  <div id="loginSection" class="section fade-in">
    <header class="bg-light py-3 border-bottom">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">Login</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4">
      <div class="row justify-content-center">
        <div class="col-12">
          <div class="card shadow-sm">
            <div class="card-body">
              <form id="loginForm">
                <div class="mb-3">
                  <label for="loginEmail" class="form-label">Email Address</label>
                  <input type="email" class="form-control" id="loginEmail" placeholder="Enter your email" required aria-label="Email Address" />
                </div>
                <div class="mb-3">
                  <label for="loginPassword" class="form-label">Password</label>
                  <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password" required minlength="6" aria-label="Password" />
                </div>
                <button type="submit" class="btn btn-primary w-100" aria-label="Login to your account">Login</button>
              </form>
              <p class="mt-3 text-center">Don't have an account? <a href="#" onclick="showSection('signupSection')">Sign Up</a></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Sign Up Section -->
  <div id="signupSection" class="section fade-in">
    <header class="bg-light py-3 border-bottom">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">Sign Up</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4">
      <div class="row justify-content-center">
        <div class="col-12">
          <div class="card shadow-sm">
            <div class="card-body">
              <form id="signupForm">
                <div class="row">
                  <div class="col-6 mb-3">
                    <label for="firstName" class="form-label">First Name</label>
                    <input type="text" class="form-control" id="firstName" placeholder="First Name" required aria-label="First Name" />
                  </div>
                  <div class="col-6 mb-3">
                    <label for="lastName" class="form-label">Last Name</label>
                    <input type="text" class="form-control" id="lastName" placeholder="Last Name" required aria-label="Last Name" />
                  </div>
                </div>
                <div class="mb-3">
                  <label for="mobileNumberSignUp" class="form-label">Mobile Number</label>
                  <input type="text" class="form-control" id="mobileNumberSignUp" placeholder="Enter your mobile number" required aria-label="Mobile Number" />
                </div>
                <div class="mb-3">
                  <label for="signupEmail" class="form-label">Email Address</label>
                  <input type="email" class="form-control" id="signupEmail" placeholder="Enter your email" required aria-label="Email Address" />
                </div>
                <div class="row">
                  <div class="col-6 mb-3">
                    <label for="signupPassword" class="form-label">Password</label>
                    <input type="password" class="form-control" id="signupPassword" placeholder="Password" required minlength="6" aria-label="Password" />
                  </div>
                  <div class="col-6 mb-3">
                    <label for="confirmPassword" class="form-label">Confirm Password</label>
                    <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm Password" required minlength="6" aria-label="Confirm Password" />
                  </div>
                </div>
                <button type="submit" class="btn btn-primary w-100" aria-label="Sign Up">Sign Up</button>
              </form>
              <p class="mt-3 text-center">Already have an account? <a href="#" onclick="showSection('loginSection')">Login</a></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Account Section -->
  <div id="accountSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">My Account</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4" id="accountContent"></div>
  </div>

  <!-- Cart Section -->
  <div id="cartSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">Your Bag</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4" id="cartContent"></div>
  </div>

  <!-- Shop Section -->
  <div id="shopSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">All Products</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4" id="shopFilterSection">
      <div id="filterSection">
        <h5>Filter Products</h5>
        <div class="row g-2">
          <div class="col-6 col-md-3">
            <select id="filterSize" class="form-select" aria-label="Filter by Size">
              <option value="">All Sizes</option>
              <option value="S">S</option>
              <option value="M">M</option>
              <option value="L">L</option>
              <option value="XL">XL</option>
              <option value="32">32</option>
              <option value="34">34</option>
              <option value="36">36</option>
            </select>
          </div>
          <div class="col-6 col-md-3">
            <select id="filterColor" class="form-select" aria-label="Filter by Color">
              <option value="">All Colors</option>
              <option value="Blue">Blue</option>
              <option value="Red">Red</option>
              <option value="Black">Black</option>
              <option value="Brown">Brown</option>
              <option value="White">White</option>
            </select>
          </div>
          <div class="col-6 col-md-3">
            <select id="filterPrice" class="form-select" aria-label="Filter by Price">
              <option value="">All Prices</option>
              <option value="100-150">₹100 - ₹150</option>
              <option value="150-200">₹150 - ₹200</option>
              <option value="200-250">₹200 - ₹250</option>
            </select>
          </div>
          <div class="col-6 col-md-3">
            <button class="btn btn-primary w-100" onclick="applyFilters()" aria-label="Apply Filters">Apply Filters</button>
          </div>
        </div>
        <div class="mt-2">
          <button class="btn btn-outline-danger" onclick="clearAllFilters()">Clear All Filters</button>
        </div>
        <div class="mt-2" id="activeFilterDisplay"></div>
      </div>
    </div>
    <div class="container my-4">
      <div class="row" id="shopProductContainer"></div>
    </div>
  </div>

 <!-- Men's Wear Section -->
 <div id="menswearSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">Men's Wear</h1>
        <div></div>
      </div>
    </header>
    <div class="container mb-3" id="menswearFilterSection">
      <div class="row g-2">
        <div class="col-4">
          <select id="menswearFilterSize" class="form-select" aria-label="Filter Men's Wear by Size">
            <option value="">All Sizes</option>
            <option value="S">S</option>
            <option value="M">M</option>
            <option value="L">L</option>
            <option value="XL">XL</option>
            <option value="32">32</option>
            <option value="34">34</option>
            <option value="36">36</option>
          </select>
        </div>
        <div class="col-4">
          <select id="menswearFilterColor" class="form-select" aria-label="Filter Men's Wear by Color">
            <option value="">All Colors</option>
            <option value="Blue">Blue</option>
            <option value="Red">Red</option>
            <option value="Black">Black</option>
            <option value="Brown">Brown</option>
            <option value="White">White</option>
          </select>
        </div>
        <div class="col-4">
          <select id="menswearFilterPrice" class="form-select" aria-label="Filter Men's Wear by Price">
            <option value="">All Prices</option>
            <option value="100-150">₹100 - ₹150</option>
            <option value="150-200">₹150 - ₹200</option>
            <option value="200-250">₹200 - ₹250</option>
          </select>
        </div>
      </div>
      <div class="mt-2">
        <button class="btn btn-primary" onclick="applyMenswearFilters()" aria-label="Apply Men's Wear Filters">Apply Filters</button>
        <button class="btn btn-outline-danger" onclick="clearMenswearFilters()" aria-label="Clear Men's Wear Filters">Clear Filters</button>
      </div>
      <div class="mt-2" id="menswearActiveFilterDisplay"></div>
    </div>
    <div class="container my-4">
      <div class="row" id="menswearContainer"></div>
    </div>
    <div class="container text-center mb-4">
      <button class="btn btn-success" onclick="showSection('cartSection')" aria-label="Proceed to Checkout">Checkout</button>
    </div>
  </div>

  <!-- Accessories Section -->
  <div id="accessoriesSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">Accessories</h1>
        <div></div>
      </div>
    </header>
    <div class="container mb-3" id="accessoriesFilterSection">
      <div class="row g-2">
        <div class="col-4">
          <select id="accessoriesFilterSize" class="form-select" aria-label="Filter Accessories by Size">
            <option value="">All Sizes</option>
            <option value="S">S</option>
            <option value="M">M</option>
            <option value="L">L</option>
            <option value="XL">XL</option>
            <option value="One Size">One Size</option>
          </select>
        </div>
        <div class="col-4">
          <select id="accessoriesFilterColor" class="form-select" aria-label="Filter Accessories by Color">
            <option value="">All Colors</option>
            <option value="Blue">Blue</option>
            <option value="Red">Red</option>
            <option value="Black">Black</option>
            <option value="Brown">Brown</option>
            <option value="White">White</option>
          </select>
        </div>
        <div class="col-4">
          <select id="accessoriesFilterPrice" class="form-select" aria-label="Filter Accessories by Price">
            <option value="">All Prices</option>
            <option value="100-150">₹100 - ₹150</option>
            <option value="150-200">₹150 - ₹200</option>
            <option value="200-250">₹200 - ₹250</option>
          </select>
        </div>
      </div>
      <div class="mt-2">
        <button class="btn btn-primary" onclick="applyAccessoriesFilters()" aria-label="Apply Accessories Filters">Apply Filters</button>
        <button class="btn btn-outline-danger" onclick="clearAccessoriesFilters()" aria-label="Clear Accessories Filters">Clear Filters</button>
      </div>
      <div class="mt-2" id="accessoriesActiveFilterDisplay"></div>
    </div>
    <div class="container my-4">
      <div class="row" id="accessoriesContainer"></div>
    </div>
    <div class="container text-center mb-4">
      <button class="btn btn-success" onclick="showSection('cartSection')" aria-label="Proceed to Checkout">Checkout</button>
    </div>
  </div>
 <!-- Enhanced Orders Section -->
   <div id="ordersSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('homeSection')" aria-label="Back to Home"><i class="bi bi-arrow-left"></i> Home</button>
        <h1 class="h5 mb-0">My Orders</h1>
        <div class="dropdown">
          <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="ordersFilterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            Filter Orders
          </button>
          <ul class="dropdown-menu" aria-labelledby="ordersFilterDropdown">
            <li><a class="dropdown-item" href="#" onclick="filterOrders('all')">All Orders</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#" onclick="filterOrders('active')">Active Orders</a></li>
            <li><a class="dropdown-item" href="#" onclick="filterOrders('completed')">Completed Orders</a></li>
        
          </ul>
        </div>
      </div>
    </header>
    <div class="container my-4" id="ordersList">
      <!-- Orders will be dynamically loaded here -->
    </div>
  </div>

  <!-- Enhanced Order Detail Section -->
  <div id="orderDetailSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('ordersSection')" aria-label="Back to Orders"><i class="bi bi-arrow-left"></i> Back to Orders</button>
        <h1 class="h5 mb-0">Order Details</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4" id="orderDetailPage">
      <!-- Order details will be dynamically loaded here -->
    </div>
  </div>

  <!-- Order Detail Section -->
  <div id="orderDetailSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('ordersSection')" aria-label="Back to Orders"><i class="bi bi-arrow-left"></i> Back to Orders</button>
        <h1 class="h5 mb-0">Order Details</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4" id="orderDetailPage"></div>
  </div>

  <!-- Product Detail Section -->
  <div id="productDetailSection" class="section fade-in">
    <header class="py-3 border-bottom bg-light">
      <div class="container d-flex justify-content-between align-items-center">
        <button class="btn" onclick="showSection('shopSection')" aria-label="Back to Shop"><i class="bi bi-arrow-left"></i> Back to Shop</button>
        <h1 class="h5 mb-0">Product Details</h1>
        <div></div>
      </div>
    </header>
    <div class="container my-4" id="productDetailPage"></div>
  </div>

  <!-- Buy Now Modal -->
  <div class="modal fade" id="buyModal" tabindex="-1" aria-labelledby="buyModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content shadow-sm">
        <div class="modal-header">
          <h5 class="modal-title" id="buyModalLabel">Enter Shipping Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="buyForm">
            <input type="hidden" name="csrf_token" value="some-token-value" />
            <div class="mb-3">
              <label for="shippingAddress" class="form-label">Address</label>
              <textarea class="form-control" id="shippingAddress" required aria-label="Shipping Address"></textarea>
            </div>
            <div class="mb-3">
              <label for="mobileNumber" class="form-label">Mobile Number</label>
              <input type="text" class="form-control" id="mobileNumber" required aria-label="Mobile Number" />
            </div>
            <div class="mb-3">
              <label for="additionalDetails" class="form-label">Additional Details</label>
              <textarea class="form-control" id="additionalDetails" aria-label="Additional Details"></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">Payment Method</label>
              <input type="text" class="form-control" value="Cash on Delivery" disabled aria-label="Payment Method" />
            </div>
            <div class="mb-3">
              <p><strong>Product:</strong> <span id="modalProductName"></span></p>
              <p><strong>Size:</strong> <span id="modalProductSize"></span></p>
              <p><strong>Color:</strong> <span id="modalProductColor"></span></p>
              <p><strong>Price:</strong> ₹<span id="modalProductPrice"></span></p>
              <p><strong>Estimated Delivery:</strong> <span id="modalDeliveryTime"></span></p>
              <p><strong>Total Amount:</strong> ₹<span id="modalTotalAmount"></span></p>
            </div>
            <hr />
            <button type="submit" class="btn btn-primary">Confirm Order</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="productImagesModal" tabindex="-1" aria-labelledby="productImagesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="productImagesModalLabel">Product Images</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner" id="carouselInner"></div>
            <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
  function showProductImagesModal(productId) {
    const product = products.find(p => p.id === productId);
    const carouselInner = document.getElementById("carouselInner");
    carouselInner.innerHTML = "";
  
    product.images.forEach((img, index) => {
      carouselInner.innerHTML += `
        <div class="carousel-item ${index === 0 ? 'active' : ''}">
          <img src="${img}" class="d-block w-100" alt="${product.name}">
        </div>
      `;
    });
  
    new bootstrap.Modal(document.getElementById('productImagesModal')).show();
  }
  </script>

  <!-- Track Order Modal -->
  <div class="modal fade" id="trackOrderModal" tabindex="-1" aria-labelledby="trackOrderModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content shadow-sm">
        <div class="modal-header">
          <h5 class="modal-title" id="trackOrderModalLabel">Track Order</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="trackOrderContent"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="sendMessageModal" tabindex="-1" aria-labelledby="sendMessageModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="sendMessageModalLabel">Send Message to User</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <textarea class="form-control" id="messageText" rows="3" placeholder="Type your message here..."></textarea>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="confirmSendMessage()">Send</button>
        </div>
      </div>
    </div>
  </div>
   <!-- Fixed Footer Navigation -->
   <footer class="footer-nav fixed-bottom">
    <div class="container d-flex justify-content-around">
      <div class="nav-item">
        <button class="btn btn-link nav-link" onclick="showSection('homeSection')" aria-label="Home">
          <i class="bi bi-house"></i><br><span class="nav-text">HOME</span>
        </button>
      </div>
      <div class="nav-item">
        <button class="btn btn-link nav-link" onclick="showSection('categoriesSection')" aria-label="Shop">
          <i class="bi bi-grid"></i><br><span class="nav-text">SHOP</span>
        </button>
      </div>
      <div class="nav-item">
        <button class="btn btn-link nav-link" onclick="showSection('searchSection')" aria-label="Search">
          <i class="bi bi-search"></i><br><span class="nav-text">SEARCH</span>
        </button>
      </div>
      <div class="nav-item">
        <button class="btn btn-link nav-link" onclick="showSection('wishlistSection')" aria-label="Wishlist">
          <i class="bi bi-heart"></i><br><span class="nav-text">WISHLIST</span>
        </button>
      </div>
      <div class="nav-item">
        <button class="btn btn-link nav-link" onclick="showSection('cartSection')" aria-label="Your Bag">
          <i class="bi bi-cart"></i><br><span class="nav-text">BAG</span>
          <span class="footer-bag-badge" id="footerBagBadge">0</span>
        </button>
      </div>
    </div>
  </footer>
   <!-- cancel order modal -->
  <div class="modal fade" id="cancelOrderModal" tabindex="-1" aria-labelledby="cancelOrderModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="cancelOrderModalLabel">Cancel Order</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to cancel this order?</p>
          <div class="mb-3">
            <label for="cancelReason" class="form-label">Reason for cancellation</label>
            <select class="form-select" id="cancelReason">
              <option value="">Select a reason</option>
              <option value="Found better price elsewhere">Found better price elsewhere</option>
              <option value="No longer needed">No longer needed</option>
              <option value="Shipping takes too long">Shipping takes too long</option>
              <option value="Ordered by mistake">Ordered by mistake</option>
              <option value="Other">Other (please specify)</option>
            </select>
          </div>
          <div class="mb-3" id="otherReasonContainer" style="display: none;">
            <label for="otherReason" class="form-label">Please specify</label>
            <textarea class="form-control" id="otherReason" rows="2"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-danger" onclick="confirmCancelOrder()">Confirm Cancellation</button>
        </div>
      </div>
    </div>
  </div>
  <!-- return order modal -->
  <div class="modal fade" id="returnOrderModal" tabindex="-1" aria-labelledby="returnOrderModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="returnOrderModalLabel">Return Item</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Please tell us why you're returning this item:</p>
          <div class="mb-3">
            <label for="returnReason" class="form-label">Reason for return</label>
            <select class="form-select" id="returnReason">
              <option value="">Select a reason</option>
              <option value="Wrong size or fit">Wrong size or fit</option>
              <option value="Item damaged or defective">Item damaged or defective</option>
              <option value="Not as described">Not as described</option>
              <option value="Changed my mind">Changed my mind</option>
              <option value="Other">Other (please specify)</option>
            </select>
          </div>
          <div class="mb-3" id="returnOtherReasonContainer" style="display: none;">
            <label for="returnOtherReason" class="form-label">Please specify</label>
            <textarea class="form-control" id="returnOtherReason" rows="2"></textarea>
          </div>
          <div class="mb-3">
            <label for="returnComments" class="form-label">Additional comments</label>
            <textarea class="form-control" id="returnComments" rows="3"></textarea>
          </div>
          <div class="alert alert-info">
            <p class="mb-0">Please note: Return requests must be made within ${orders[currentOrderIndex].product.returnPolicy} of delivery.</p>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" onclick="confirmReturnOrder()">Submit Return Request</button>
        </div>
      </div>
    </div>
  </div>
   <!-- Review Order Modal -->
<div class="modal fade" id="reviewOrderModal" tabindex="-1" aria-labelledby="reviewOrderModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="reviewOrderModalLabel">Rate & Review</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="text-center mb-4">
          <h6>How would you rate this product?</h6>
          <div class="rating-stars mb-2" id="ratingStars">
            <span data-value="5">☆</span>
            <span data-value="4">☆</span>
            <span data-value="3">☆</span>
            <span data-value="2">☆</span>
            <span data-value="1">☆</span>
          </div>
          <small class="text-muted" id="ratingText">Tap to rate</small>
        </div>
        <div class="mb-3">
          <label for="reviewTitle" class="form-label">Review Title</label>
          <input type="text" class="form-control" id="reviewTitle" placeholder="Summarize your experience">
        </div>
        <div class="mb-3">
          <label for="reviewText" class="form-label">Your Review</label>
          <textarea class="form-control" id="reviewText" rows="4" placeholder="Share details about your experience with this product"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" onclick="submitReview()">Submit Review</button>
      </div>
    </div>
  </div>
</div>

<!-- View Review Modal -->
<div class="modal fade" id="viewReviewModal" tabindex="-1" aria-labelledby="viewReviewModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="viewReviewModalLabel">Your Review</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="text-center mb-4">
          <div class="rating-stars mb-2"></div>
          <h5 id="reviewTitleDisplay"></h5>
        </div>
        <div class="mb-3">
          <p id="reviewTextDisplay"></p>
        </div>
        <div class="text-muted small" id="reviewDateDisplay"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
  <!-- JavaScript -->
  <script>
    // Global variables
    let users = [];
    let cart = [];
    let orders = [];
    let notifications = [];
    let ownerNotifications = [];
    let wishlist = [];
    let currentUser = null;
    let currentProductForPurchase = null;
    let currentOrderIndex = null;
    let activeFilters = {};
    let menswearActiveFilters = {};
    let accessoriesActiveFilters = {};
    let recentSearches = [];
    let searchTimeout = null;

    const locations = ["New York", "Los Angeles", "Chicago", "Houston", "Phoenix"];
    const colorMap = { "Blue": "#0000FF", "Red": "#FF0000", "Black": "#000000",  "Brown": "#8B4513", "White": "#FFFFFF" };
    let currentOrderIndexForMessage = null;

function setCurrentOrderIndex(index) {
  currentOrderIndexForMessage = index;
}

function confirmSendMessage() {
  const message = document.getElementById("messageText").value.trim();
  if (!message) {
    showNotification("Please enter a message.", "warning");
    return;
  }
  const order = orders[currentOrderIndexForMessage];
  const user = users.find(u => u.email === order.buyer.email);
  if (user) {
    if (!user.notifications) user.notifications = [];
    user.notifications.push({
      message: `Message from Owner: ${message}`,
      type: "info",
      title: "Message from Owner",
      date: new Date().toLocaleString()
    });
    showNotification(`Message sent to user: ${user.firstName} ${user.lastName}`, "success");
    saveData();
    const modal = bootstrap.Modal.getInstance(document.getElementById("sendMessageModal"));
    modal.hide();
    document.getElementById("messageText").value = ""; // Clear the textarea
  } else {
    showNotification("User not found.", "warning");
  }
}
const products = [
      {
        id: 1,
        name: "Casual Shirt",
        description: "Comfortable and stylish men's t-shirt.",
        category: "Men's Wear",
        price: 19.99,
        size: "S, M, L, XL",
        color: "Blue, Red, Black",
        clothType: "100% Cotton",
        deliveryTime: "3-5 days",
        returnPolicy: "10 days return policy",
        additionalDetails: "Machine washable, soft and breathable fabric.",
        images: [
          "https://i.pinimg.com/474x/a2/46/9b/a2469b27a79d4853f1fa20114c5e9fe6.jpg"
        ],
        colorImages: {
          "Blue": "https://i.pinimg.com/474x/2d/94/0b/2d940bf9a87c975563445088889db80e.jpg",
          "Red": "https://i.pinimg.com/474x/9b/e5/57/9be5570d3ed2ae5ccea0b5350259fe15.jpg",
          "Black": "https://i.pinimg.com/474x/12/36/ad/1236ad818c0561546a861e5a97dc37b1.jpg"
        }
      },
      {
        id: 2,
        name: "Formal Shirt",
        description: "Premium quality formal shirt for office wear.",
        category: "Men's Wear",
        price: 29.99,
        size: "S, M, L, XL",
        color: "White, Blue",
        clothType: "Cotton Blend",
        deliveryTime: "4-6 days",
        returnPolicy: "14 days return policy",
        additionalDetails: "Iron-free, wrinkle-resistant fabric.",
        images: [
          "https://i.pinimg.com/474x/d0/fd/28/d0fd28fc614775339300cf6f2ab043d2.jpg"
        ],
        colorImages: {
          "White": "https://i.pinimg.com/474x/d0/fd/28/d0fd28fc614775339300cf6f2ab043d2.jpg",
          "Blue": "https://i.pinimg.com/474x/1e/d0/ed/1ed0ede5c364f2c8959976120f65271f.jpg"
        }
      },
      {
        id: 3,
        name: "Denim Jeans",
        description: "Trendy and comfortable denim jeans.",
        category: "Men's Wear",
        price: 39.99,
        size: "32, 34, 36",
        color: "Blue,Black",
        clothType: "Denim",
        deliveryTime: "4-6 days",
        returnPolicy: "10 days return policy",
        additionalDetails: "Slim fit design. Durable and stylish.",
        images: [
          "https://i.pinimg.com/474x/93/d5/c4/93d5c498f9800930a8012a4a53bdbaec.jpg",
          "https://i.pinimg.com/474x/33/ec/71/33ec716cc1c75f58fc99fd5e7d221024.jpg"
        ],
        colorImages: {
          "Blue": "https://i.pinimg.com/474x/3e/21/6e/3e216e3c3ee793f79269c2ad441697c5.jpg",
          "Black": "https://i.pinimg.com/474x/cd/5c/14/cd5c14c5a5daff62ee33d104ae4a381a.jpg"
        }
      },
      {
        id: 4,
        name: "Sunglasses",
        description: "Stylish sunglasses to match your look.",
        category: "Accessories",
        price: 29.99,
        size: "One Size",
        color: "Black, Brown",
        clothType: "Plastic/Metal",
        deliveryTime: "2-4 days",
        returnPolicy: "7 days return policy",
        additionalDetails: "UV protection, lightweight.",
        images: [
          "https://i.pinimg.com/474x/8f/4f/6f/8f4f6f1f8c8e9b2e4f1b5c6d7e8f9a0b.jpg"
        ],
        colorImages: {
          "Black": "https://i.pinimg.com/474x/8f/4f/6f/8f4f6f1f8c8e9b2e4f1b5c6d7e8f9a0b.jpg",
          "Brown": "https://i.pinimg.com/474x/5d/3e/2f/5d3e2f6e8c9b0a1c2d3e4f5a6b7c8d9.jpg"
        }
      },
      {
        id: 5,
        name: "Leather Belt",
        description: "Genuine leather belt for men.",
        category: "Accessories",
        price: 24.99,
        size: "32, 34, 36, 38",
        color: "Black, Brown",
        clothType: "Genuine Leather",
        deliveryTime: "3-5 days",
        returnPolicy: "14 days return policy",
        additionalDetails: "Adjustable buckle, durable material.",
        images: [
          "https://i.pinimg.com/474x/7a/8b/3d/7a8b3d9e8f9a0b1c2d3e4f5a6b7c8d9e.jpg"
        ],
        colorImages: {
          "Black": "https://i.pinimg.com/474x/7a/8b/3d/7a8b3d9e8f9a0b1c2d3e4f5a6b7c8d9e.jpg",
          "Brown": "https://i.pinimg.com/474x/8c/9d/0e/8c9d0e9f8a0b1c2d3e4f5a6b7c8d9e0.jpg"
        }
      },
      {
        id: 6,
        name: "Casual T-Shirt",
        description: "Comfortable cotton t-shirt for everyday wear.",
        category: "Men's Wear",
        price: 15.99,
        size: "S, M, L, XL",
        color: "White, Black, Blue",
        clothType: "100% Cotton",
        deliveryTime: "2-4 days",
        returnPolicy: "7 days return policy",
        additionalDetails: "Breathable fabric, machine washable.",
        images: [
          "https://i.pinimg.com/474x/9e/f0/1d/9ef01d9e8f9a0b1c2d3e4f5a6b7c8d9e.jpg"
        ],
        colorImages: {
          "White": "https://i.pinimg.com/474x/9e/f0/1d/9ef01d9e8f9a0b1c2d3e4f5a6b7c8d9e.jpg",
          "Black": "https://i.pinimg.com/474x/a0/b1/c2/a0b1c29e8f9a0b1c2d3e4f5a6b7c8d9e.jpg",
          "Blue": "https://i.pinimg.com/474x/b1/c2/d3/b1c2d39e8f9a0b1c2d3e4f5a6b7c8d9e.jpg"
        }
      },
      {
        id: 7,
        name: "Wrist Watch",
        description: "Elegant wrist watch for men.",
        category: "Accessories",
        price: 49.99,
        size: "One Size",
        color: "Black, Silver",
        clothType: "Stainless Steel",
        deliveryTime: "3-5 days",
        returnPolicy: "14 days return policy",
        additionalDetails: "Water resistant, durable strap.",
        images: [
          "https://i.pinimg.com/474x/c2/d3/e4/c2d3e49e8f9a0b1c2d3e4f5a6b7c8d9e.jpg"
        ],
        colorImages: {
          "Black": "https://i.pinimg.com/474x/c2/d3/e4/c2d3e49e8f9a0b1c2d3e4f5a6b7c8d9e.jpg",
          "Silver": "https://i.pinimg.com/474x/d3/e4/f5/d3e4f59e8f9a0b1c2d3e4f5a6b7c8d9e.jpg"
        }
      },
    ];
     // Hide splash screen after 2 seconds
     setTimeout(() => {
      const splashScreen = document.getElementById('splashScreen');
      splashScreen.style.opacity = '0';
      setTimeout(() => {
        splashScreen.style.display = 'none';
        document.getElementById('shopNowButton').focus();
      }, 500); // Matches the CSS transition duration of 0.5s
    }, 2000);
    

    // Save data to localStorage
    function saveData() {
      localStorage.setItem("users", JSON.stringify(users));
      localStorage.setItem("cart", JSON.stringify(cart));
      localStorage.setItem("orders", JSON.stringify(orders));
      localStorage.setItem("notifications", JSON.stringify(notifications));
      localStorage.setItem("ownerNotifications", JSON.stringify(ownerNotifications));
      localStorage.setItem("wishlist", JSON.stringify(wishlist));
      localStorage.setItem("currentUser", JSON.stringify(currentUser));
    }

    // Load data from localStorage
    function loadData() {
      users = JSON.parse(localStorage.getItem("users")) || [];
      cart = JSON.parse(localStorage.getItem("cart")) || [];
      orders = JSON.parse(localStorage.getItem("orders")) || [];
      notifications = JSON.parse(localStorage.getItem("notifications")) || [];
      ownerNotifications = JSON.parse(localStorage.getItem("ownerNotifications")) || [];
      wishlist = JSON.parse(localStorage.getItem("wishlist")) || [];
      currentUser = JSON.parse(localStorage.getItem("currentUser"));
      if (currentUser && currentUser.isLoggedIn) {
        const user = users.find(u => u.email === currentUser.email);
        if (user) {
          currentUser = { ...user, isLoggedIn: true, lastActivity: new Date().toISOString() };
        } else {
          currentUser = null;
        }
      } else {
        currentUser = null;
      }
      updateHeaderProfile();
      updateMenuAccountDetails();
      updateCartCountBadge();
      generateProducts("shopProductContainer", products);
      generateProducts("menswearContainer", products.filter(p => p.category === "Men's Wear"));
      generateProducts("accessoriesContainer", products.filter(p => p.category === "Accessories"));
    }
    


// Initialize rating when review modal is shown
document.getElementById('reviewOrderModal')?.addEventListener('show.bs.modal', function() {
  const order = orders[currentOrderIndex];
  const ratingStars = document.getElementById('ratingStars');
  
  // Clear any previous selection
  ratingStars.querySelectorAll('span').forEach(star => {
    star.textContent = '☆';
  });
  
  // If there's an existing rating, highlight the stars
  if (order.rating) {
    highlightStars(order.rating);
  }
  
  // Reset the rating text
  document.getElementById('ratingText').textContent = 'Tap to rate';
  
  // Clear review fields
  document.getElementById('reviewTitle').value = '';
  document.getElementById('reviewText').value = '';
});

// Handle star rating selection
document.getElementById('ratingStars')?.addEventListener('click', function(e) {
  if (e.target.tagName === 'SPAN') {
    const value = parseInt(e.target.getAttribute('data-value'));
    highlightStars(value);
    
    // Update rating text
    const ratingText = document.getElementById('ratingText');
    ratingText.textContent = `${value} star${value !== 1 ? 's' : ''}`;
    ratingText.style.color = '#000';
    
    // Store the selected rating
    document.getElementById('ratingStars').dataset.selectedRating = value;
  }
});

// Function to highlight stars up to the selected value
function highlightStars(value) {
  const stars = document.getElementById('ratingStars').querySelectorAll('span');
  stars.forEach((star, index) => {
    const starValue = parseInt(star.getAttribute('data-value'));
    star.textContent = starValue <= value ? '★' : '☆';
    star.style.color = starValue <= value ? 'gold' : '#000';
  });
}

// Submit review function
function submitReview() {
  const ratingStars = document.getElementById('ratingStars');
  const selectedRating = ratingStars.dataset.selectedRating;
  const reviewTitle = document.getElementById('reviewTitle').value.trim();
  const reviewText = document.getElementById('reviewText').value.trim();
  
  if (!selectedRating) {
    showNotification('Please select a rating by tapping the stars', 'warning');
    return;
  }
  
  if (!reviewTitle) {
    showNotification('Please enter a title for your review', 'warning');
    return;
  }
  
  if (!reviewText) {
    showNotification('Please write your review', 'warning');
    return;
  }
  
  // Update the order with review details
  const order = orders[currentOrderIndex];
  order.rating = parseInt(selectedRating);
  order.reviewTitle = reviewTitle;
  order.review = reviewText;
  order.reviewDate = new Date().toLocaleString();
  
  // Save the data
  saveData();
  
  // Close the modal
  const modal = bootstrap.Modal.getInstance(document.getElementById('reviewOrderModal'));
  modal.hide();
  
  // Show success message
  showNotification('Thank you for your review!', 'success');
  
  // Update the order detail view
  showOrderDetailPage(currentOrderIndex);
}

// Confirm return order function
function confirmReturnOrder() {
  const returnReason = document.getElementById('returnReason').value;
  const returnOtherReason = document.getElementById('returnOtherReason').value.trim();
  const returnComments = document.getElementById('returnComments').value.trim();
  
  let reason = returnReason;
  if (returnReason === 'Other') {
    if (!returnOtherReason) {
      showNotification('Please specify the return reason', 'warning');
      return;
    }
    reason = returnOtherReason;
  }
  
 
  // Save the data
  saveData();
  
  // Close the modal
  const modal = bootstrap.Modal.getInstance(document.getElementById('returnOrderModal'));
  modal.hide();
  
  // Show success message
  showNotification('Your return request has been submitted', 'success');
  
  // Update the order detail view
  showOrderDetailPage(currentOrderIndex);
}

// Update the view review modal when shown
document.getElementById('viewReviewModal')?.addEventListener('show.bs.modal', function() {
  const order = orders[currentOrderIndex];
  const modal = document.getElementById('viewReviewModal');
  
  if (!order.rating) return;
  
  // Update the modal content with the review details
  modal.querySelector('.modal-title').textContent = `Your Review of ${order.product.name}`;
  
  const starsContainer = modal.querySelector('.rating-stars');
  starsContainer.innerHTML = '';
  for (let i = 1; i <= 5; i++) {
    starsContainer.innerHTML += i <= order.rating ? '★' : '☆';
  }
  
  modal.querySelector('h5').textContent = order.reviewTitle || 'Your Review';
  modal.querySelector('p').textContent = order.review || 'No review text provided.';
  modal.querySelector('.small').textContent = `Reviewed on ${order.reviewDate || 'Unknown date'}`;
});


    // Update header profile
    function updateHeaderProfile() {
      const headerProfile = document.getElementById("headerProfile");
      headerProfile.textContent = currentUser ? `${currentUser.firstName} ${currentUser.lastName}` : "";
    }

    // Hide menu
    function hideMenu() {
      const menuCanvas = bootstrap.Offcanvas.getInstance(document.getElementById("menuCanvas"));
      if (menuCanvas) menuCanvas.hide();
    }

    function getProductRating(productId) {
      const productOrders = orders.filter(order => order.product.id === productId && order.rating !== null);
      if (productOrders.length === 0) {
        return null;
      }
      const totalRating = productOrders.reduce((sum, order) => sum + order.rating, 0);
      const averageRating = totalRating / productOrders.length;
      return { average: averageRating.toFixed(1), count: productOrders.length };
    }
   // Toggle search bar visibility
   function toggleSearchBar() {
    const searchBarContainer = document.getElementById("searchBarContainer");
    if (searchBarContainer.style.display === "none" || searchBarContainer.style.display === "") {
      searchBarContainer.style.display = "flex";
      document.getElementById("searchSectionInput").focus();
      performSearch();
    } else {
      searchBarContainer.style.display = "none";
    }
  }

  // Handle search input with debounce
  function handleSearchInput() {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      performSearch();
      showSearchSuggestions();
    }, 300); // 300ms debounce delay
  }

  // Show search suggestions
  function showSearchSuggestions() {
    const input = document.getElementById("searchSectionInput").value.toLowerCase();
    const suggestionsContainer = document.getElementById("searchSuggestions");

    if (input.length < 2) {
      suggestionsContainer.style.display = "none";
      return;
    }

    const suggestions = products.filter(product =>
      product.name.toLowerCase().includes(input) ||
      product.description.toLowerCase().includes(input) ||
      product.category.toLowerCase().includes(input)
    ).slice(0, 5);

    if (suggestions.length === 0) {
      suggestionsContainer.style.display = "none";
      return;
    }

    let html = '';
    suggestions.forEach(product => {
      html += `
        <div class="search-suggestion-item" onclick="document.getElementById('searchSectionInput').value='${product.name}'; performSearch(); document.getElementById('searchSuggestions').style.display='none';">
          ${product.name} - ${product.category}
        </div>
      `;
    });

    suggestionsContainer.innerHTML = html;
    suggestionsContainer.style.display = "block";
  }

  // Perform search
  function performSearch() {
    const query = document.getElementById("searchSectionInput").value.toLowerCase();
    const category = document.getElementById("searchCategory").value;
    const priceRange = document.getElementById("searchPrice").value;
    const minRating = document.getElementById("searchRating").value;
    const sortBy = document.getElementById("searchSort").value;

    let filteredProducts = [...products];

    if (query) {
      filteredProducts = filteredProducts.filter(p =>
        p.name.toLowerCase().includes(query) ||
        p.description.toLowerCase().includes(query) ||
        p.category.toLowerCase().includes(query)
      );
    }

    if (category) {
      filteredProducts = filteredProducts.filter(p => p.category === category);
    }

    if (priceRange) {
      const [min, max] = priceRange.split("-").map(Number);
      filteredProducts = filteredProducts.filter(p => {
        if (max) return p.price >= min && p.price <= max;
        return p.price >= min;
      });
    }

    if (minRating) {
      filteredProducts = filteredProducts.filter(p => {
        const ratingInfo = getProductRating(p.id);
        return ratingInfo && ratingInfo.average >= parseInt(minRating);
      });
    }

    switch (sortBy) {
      case "price-low":
        filteredProducts.sort((a, b) => a.price - b.price);
        break;
      case "price-high":
        filteredProducts.sort((a, b) => b.price - a.price);
        break;
      case "rating":
        filteredProducts.sort((a, b) => {
          const ratingA = getProductRating(a.id)?.average || 0;
          const ratingB = getProductRating(b.id)?.average || 0;
          return ratingB - ratingA;
        });
        break;
      case "newest":
        filteredProducts.sort((a, b) => b.id - a.id);
        break;
      default:
        if (query) {
          filteredProducts.sort((a, b) => {
            const aMatches = a.name.toLowerCase().includes(query) ? 1 : 0;
            const bMatches = b.name.toLowerCase().includes(query) ? 1 : 0;
            return bMatches - aMatches;
          });
        }
    }

    displaySearchResults(filteredProducts);
    updateSearchActiveFilters(query, category, priceRange, minRating);
  }

  // Display search results
  function displaySearchResults(results) {
    const container = document.getElementById("searchResultsContainer");
    const countElement = document.getElementById("searchResultsCount");

    countElement.textContent = `${results.length} products found`;

    if (results.length === 0) {
      container.innerHTML = "<p>No products found.</p>";
      return;
    }

    container.innerHTML = "";
    results.forEach(product => {
      const originalPrice = (product.price * 1.2).toFixed(2);
      const discount = ((originalPrice - product.price) / originalPrice * 100).toFixed(0);
      const card = `
        <div class="col-6 mb-4">
          <div class="card shadow-sm product-card" style="position: relative;" onclick="showProductDetails(${product.id})">
            <img src="${product.images && product.images.length ? product.images[0] : 'https://via.placeholder.com/400x300?text=' + encodeURIComponent(product.name)}" class="card-img-top" alt="${product.name}">
            <button class="wishlist-btn position-absolute top-0 end-0 m-2" onclick="event.stopPropagation(); addToWishlist(${product.id})" aria-label="Add ${product.name} to Wishlist">
              <i class="bi bi-heart-fill" style="color: ${wishlist.some(p => p.id === product.id) ? 'red' : '#ccc'};"></i>
            </button>
            <div class="card-body">
              <h5 class="card-title">${product.name}</h5>
              <p class="card-text">${product.description}</p>
              <p class="card-text"><s>₹${originalPrice}</s> ₹${product.price.toFixed(2)} <span class="badge bg-success">${discount}% off</span></p>
            </div>
          </div>
        </div>
      `;
      container.innerHTML += card;
    });
  }

  // Voice search functionality
 // Voice search functionality
function startVoiceSearch() {
    // Check if the browser supports the Web Speech API
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) {
      showNotification("Voice search is not supported in your browser.", "warning");
      return;
    }
  
    const recognition = new SpeechRecognition();
    const voiceSearchBtn = document.getElementById("voiceSearchButton");
  
    // Configure recognition settings for better accuracy
    recognition.continuous = false; // Single utterance for better control
    recognition.interimResults = false; // Wait for final results to avoid partial matches
    recognition.lang = "en-US"; // Default to English, can be made configurable
    recognition.maxAlternatives = 3; // Get multiple alternatives for better matching
  
    // Visual feedback when voice search starts
    recognition.onstart = function () {
      voiceSearchBtn.classList.add("active"); // Add a visual cue (e.g., highlight button)
      voiceSearchBtn.innerHTML = '<i class="bi bi-mic-fill"></i>'; // Change icon to indicate recording
      showNotification("Listening... Please speak clearly.", "info", { duration: 2000 });
    };
  
    // Handle the speech recognition result
    recognition.onresult = function (event) {
      const results = event.results[0];
      let transcript = results[0].transcript.trim().toLowerCase();
  
      // Post-process the transcript to improve accuracy for e-commerce terms
      transcript = cleanTranscript(transcript);
  
      // Add to search history and perform the search
      document.getElementById("searchSectionInput").value = transcript;
      toggleSearchBar(); // Show the search bar with the result
      addToSearchHistory(transcript); // Assuming this function exists
      performSearch(); // Trigger the search
      showNotification(`Searching for: "${transcript}"`, "success");
  
      // Reset button state
      resetVoiceSearchButton();
    };
  
    // Handle errors gracefully
    recognition.onerror = function (event) {
      resetVoiceSearchButton();
      let errorMessage = "An error occurred during voice search.";
      switch (event.error) {
        case "no-speech":
          errorMessage = "No speech detected. Please try again.";
          break;
        case "not-allowed":
        case "service-not-allowed":
          errorMessage = "Microphone access denied. Please enable it in your browser settings.";
          break;
        case "audio-capture":
          errorMessage = "No microphone detected. Please ensure one is connected.";
          break;
        default:
          errorMessage = `Voice search error: ${event.error}`;
      }
      showNotification(errorMessage, "danger");
    };
  
    // Reset state when recognition ends
    recognition.onend = function () {
      resetVoiceSearchButton();
      showNotification("Voice search completed.", "info", { duration: 1500 });
    };
  
    // Start recognition
    try {
      recognition.start();
    } catch (e) {
      resetVoiceSearchButton();
      showNotification("Failed to start voice search. Please try again.", "danger");
    }
  }
  
  // Helper function to clean up the transcript
  function cleanTranscript(transcript) {
    // Remove common filler words and improve product name matching
    const fillers = ["um", "uh", "like", "you know"];
    let cleaned = transcript.split(" ").filter(word => !fillers.includes(word)).join(" ");
  
    // Map common misrecognitions or shorthand to actual product terms
    const corrections = {
      "t shirt": "t-shirt",
      "jeans": "denim jeans",
      "sun glasses": "sunglasses",
      "watch": "wrist watch",
      "accessory": "accessories",
    };
    Object.keys(corrections).forEach(mistake => {
      if (cleaned.includes(mistake)) {
        cleaned = cleaned.replace(mistake, corrections[mistake]);
      }
    });
  
    return cleaned;
  }
  
  // Helper function to reset the voice search button
  function resetVoiceSearchButton() {
    const voiceSearchBtn = document.getElementById("voiceSearchButton");
    voiceSearchBtn.classList.remove("active");
    voiceSearchBtn.innerHTML = '<i class="bi bi-mic"></i>'; // Restore original icon
  }
    // Enhanced voice search for mobile
    function startVoiceSearch() {
      const recognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!recognition) {
        showNotification("Voice search is not supported on this device.", "warning");
        return;
      }

      const voiceSearchBtn = document.getElementById("voiceSearchButton");
      const recognitionInstance = new recognition();
      recognitionInstance.continuous = false;
      recognitionInstance.interimResults = false;
      recognitionInstance.lang = "en-US";

      recognitionInstance.onstart = () => {
        voiceSearchBtn.classList.add("active");
        showNotification("Voice search started. Please speak now.", "info");
      };

      recognitionInstance.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById("searchSectionInput").value = transcript;
        toggleSearchBar();
        addToSearchHistory(transcript);
        performSearch();
        showNotification(`Searching for: "${transcript}"`, "success");
      };

      recognitionInstance.onerror = (event) => {
        voiceSearchBtn.classList.remove("active");
        if (event.error === "no-speech") {
          showNotification("No speech detected. Please try again.", "warning");
        } else if (event.error === "not-allowed" || event.error === "service-not-allowed") {
          showNotification("Microphone access denied. Please enable it in your settings.", "danger");
        } else {
          showNotification(`Voice search error: ${event.error}`, "danger");
        }
      };

      recognitionInstance.onend = () => {
        voiceSearchBtn.classList.remove("active");
        showNotification("Voice search ended.", "info");
      };

      try {
        recognitionInstance.start();
      } catch (e) {
        showNotification("Error starting voice search. Please try again.", "danger");
      }
    }
 
   // In the generateProducts function, modify the column classes:
function generateProducts(containerId, productList) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";
  productList.forEach(product => {
    const originalPrice = (product.price * 1.2).toFixed(2);
    const discount = ((originalPrice - product.price) / originalPrice * 100).toFixed(0);
    const card = `
      <div class="col-6 mb-4"> <!-- Changed from col-6 col-md-4 to col-6 for consistent two-column layout on all devices -->
        <div class="card shadow-sm product-card" style="position: relative;" onclick="showProductDetails(${product.id})">
          <img src="${product.images && product.images.length ? product.images[0] : 'https://via.placeholder.com/400x300?text=' + encodeURIComponent(product.name)}" class="card-img-top" alt="${product.name}">
          <button class="wishlist-btn position-absolute top-0 end-0 m-2" onclick="event.stopPropagation(); addToWishlist(${product.id})" aria-label="Add ${product.name} to Wishlist">
            <i class="bi bi-heart-fill" style="color: ${wishlist.some(p => p.id === product.id) ? 'red' : '#ccc'};"></i>
          </button>
          <div class="card-body">
            <h5 class="card-title">${product.name}</h5>
            <p class="card-text">${product.description}</p>
            <p class="card-text"><s>₹${originalPrice}</s> ₹${product.price.toFixed(2)} <span class="badge bg-success">${discount}% off</span></p>
          </div>
        </div>
      </div>
    `;
    container.innerHTML += card;
  });
}

    // Function to calculate the average rating for a product
    function getProductRating(productId) {
      const productOrders = orders.filter(order => order.product.id === productId && order.rating !== null && order.rating !== undefined);
      if (productOrders.length === 0) {
        return null;
      }
      const totalRating = productOrders.reduce((sum, order) => sum + order.rating, 0);
      const averageRating = totalRating / productOrders.length;
      return { average: averageRating.toFixed(1), count: productOrders.length };
    }

    // Get recommended products based on current product
    function getRecommendedProducts(currentProductId) {
      const currentProduct = products.find(p => p.id === currentProductId);
      if (!currentProduct) return [];
      
      // Find products in the same category, excluding the current product
      let recommendations = products.filter(p => 
        p.category === currentProduct.category && 
        p.id !== currentProductId
      );
      
      // If not enough recommendations, add some from other categories
      if (recommendations.length < 4) {
        const otherProducts = products.filter(p => 
          p.category !== currentProduct.category && 
          p.id !== currentProductId
        );
        recommendations = [...recommendations, ...otherProducts.slice(0, 4 - recommendations.length)];
      }
      
      return recommendations.slice(0, 4); // Return max 4 recommendations
    }

    // Generate HTML for recommended products
    function generateRecommendedProducts(recommendations) {
      if (recommendations.length === 0) return '';
      
      let html = `
        <div class="recommendations-section">
          <h3 class="recommendations-title">You May Also Like</h3>
          <div class="row">
      `;
      
      recommendations.forEach(product => {
        const originalPrice = (product.price * 1.2).toFixed(2);
        const discount = ((originalPrice - product.price) / originalPrice * 100).toFixed(0);
        
        html += `
          <div class="col-6 col-md-3">
            <div class="card recommendation-card" onclick="showProductDetails(${product.id})">
              <img src="${product.images && product.images.length ? product.images[0] : 'https://via.placeholder.com/400x300?text=' + encodeURIComponent(product.name)}" 
                   class="card-img-top recommendation-img" alt="${product.name}">
              <span class="recommendation-badge">${discount}% OFF</span>
              <div class="card-body">
                <h5 class="card-title">${product.name}</h5>
                <p class="card-text"><s>₹${originalPrice}</s> ₹${product.price.toFixed(2)}</p>
              </div>
            </div>
          </div>
        `;
      });
      
      html += `
          </div>
        </div>
      `;
      
      return html;
    }

    // Updated showProductDetails function with star rating display and recommendations
    function showProductDetails(productId) {
      const product = products.find(p => p.id === productId);
      if (!product) return;

      const sizes = product.size.split(",").map(s => s.trim());
      const colors = product.color.split(",").map(c => c.trim());

      let sizeButtons = sizes.map(size => `
        <button type="button" class="btn btn-outline-secondary size-btn" data-size="${size}" onclick="selectSize('${size}')">${size}</button>
      `).join("");

      let colorThumbnails = colors.map(color => {
        const imageUrl = product.colorImages[color];
        return `
          <div class="color-thumbnail" data-color="${color}" onclick="selectColor('${color}')">
            <img src="${imageUrl}" alt="${color}" style="width: 50px; height: 50px;" />
          </div>
        `;
      }).join("");

      // Get rating information
      const ratingInfo = getProductRating(productId);
      
      // Get recommended products
      const recommendations = getRecommendedProducts(productId);
      const recommendationsHTML = generateRecommendedProducts(recommendations);

      const detailContent = `
        <div class="row">
          <div class="col-md-6">
            ${generateProductImageHTML(product)}
          </div>
          <div class="col-md-6">
            <h3>${product.name}</h3>
            <p>${product.description}</p>
            <p><i class="fas fa-tag"></i> <strong>Price:</strong> <s>₹${(product.price * 1.2).toFixed(2)}</s> ₹${product.price.toFixed(2)}</p>
            ${ratingInfo ? `<p><i class="fas fa-star"></i> <strong>Rating:</strong> ${ratingInfo.average} (${ratingInfo.count} ratings)</p>` : ''}
            <p><i class="fas fa-list-alt"></i> <strong>Category:</strong> ${product.category}</p>
            <p><i class="fas fa-tshirt"></i> <strong>Cloth Type:</strong> ${product.clothType}</p>
            <p><i class="fas fa-truck"></i> <strong>Delivery:</strong> ${product.deliveryTime}</p>
            <p><i class="fas fa-undo"></i> <strong>Return:</strong> ${product.returnPolicy}</p>
            <p><i class="fas fa-info-circle"></i> <strong>Details:</strong> ${product.additionalDetails}</p>
            <div class="mb-3">
              <label><strong>Sizes:</strong></label><br>
              ${sizeButtons}
            </div>
            <div class="mb-3">
              <label><strong>Colors:</strong></label><br>
              ${colorThumbnails}
            </div>
            <button class="btn btn-success w-100 mb-2" onclick="buyProductWithSelection(${product.id})">
              <i class="fas fa-shopping-cart me-1"></i> Buy Now
            </button>
            <button class="btn btn-primary w-100" onclick="addToCartWithSelection(${product.id})">
              <i class="fas fa-cart-plus me-1"></i> Add to Bag
            </button>
          </div>
        </div>
        ${recommendationsHTML}
      `;
      
      document.getElementById("productDetailPage").innerHTML = detailContent;
      document.getElementById("productDetailSection").dataset.productId = productId;
      const firstColor = colors[0];
      selectColor(firstColor);
      showSection("productDetailSection");
    }

    // Select size
    function selectSize(size) {
      document.querySelectorAll(".size-btn").forEach(btn => btn.classList.remove("active"));
      const button = document.querySelector(`.size-btn[data-size="${size}"]`);
      button.classList.add("active");
      document.getElementById("productDetailSection").dataset.selectedSize = size;
    }

    // Select color
    function selectColor(color) {
      // Remove selected class from all thumbnails
      document.querySelectorAll(".color-thumbnail").forEach(thumb => thumb.classList.remove("selected"));
      // Add selected class to the clicked thumbnail
      const thumbnail = document.querySelector(`.color-thumbnail[data-color="${color}"]`);
      if (thumbnail) thumbnail.classList.add("selected");
      // Change main image
      const productId = parseInt(document.getElementById("productDetailSection").dataset.productId);
      const product = products.find(p => p.id === productId);
      if (product && product.colorImages[color]) {
        document.getElementById("mainProductImage").src = product.colorImages[color];
      }
      // Set selected color
      document.getElementById("productDetailSection").dataset.selectedColor = color;
    }
    
    // Add to cart with selection
    function addToCartWithSelection(productId) {
        const selectedSize = document.getElementById("sizeSelect")?.value || document.getElementById("productDetailSection").dataset.selectedSize;
        const selectedColor = document.getElementById("productDetailSection").dataset.selectedColor;
        if (!selectedSize || !selectedColor) {
          showNotification("Please select size and color.", "warning");
          return;
        }
        const product = products.find(p => p.id === productId);
        if (product) {
          const cartItem = { ...product, selectedSize, selectedColor };
          cart.push(cartItem);
          showNotification(`${product.name} added to your with size ${selectedSize} and color ${selectedColor}.`, "info");
          updateCartCountBadge();
          saveData();
        }
      }

    // Buy product with selection
    function buyProductWithSelection(productId) {
      if (!currentUser) {
        showNotification("Please log in or sign up before placing an order.", "warning");
        showSection("loginSection");
        return;
      }
      const selectedSize = document.getElementById("sizeSelect")?.value || document.getElementById("productDetailSection").dataset.selectedSize;
      const selectedColor = document.getElementById("productDetailSection").dataset.selectedColor;
      if (!selectedSize || !selectedColor) {
        showNotification("Please select size and color.", "warning");
        return;
      }
      const product = products.find(p => p.id === productId);
      if (product) {
        currentProductForPurchase = { ...product, selectedSize, selectedColor };
        const daysRange = product.deliveryTime.match(/\d+-\d+/)[0];
        const maxDays = parseInt(daysRange.split("-")[1]);
        const today = new Date();
        const estimatedDeliveryDate = new Date(today);
        estimatedDeliveryDate.setDate(today.getDate() + maxDays);
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        const formattedDate = estimatedDeliveryDate.toLocaleDateString('en-US', options);
        document.getElementById("modalProductName").textContent = product.name;
        document.getElementById("modalProductSize").textContent = selectedSize;
        document.getElementById("modalProductColor").textContent = selectedColor;
        document.getElementById("modalProductPrice").textContent = product.price.toFixed(2);
        document.getElementById("modalDeliveryTime").textContent = formattedDate;
        document.getElementById("modalTotalAmount").textContent = (product.price + 5).toFixed(2); // Assuming +5 for shipping
        document.getElementById("buyForm").reset();
        const buyModal = new bootstrap.Modal(document.getElementById("buyModal"));
        buyModal.show();
      }
    }
    // Show notification
    function showNotification(message, type = "success", options = {}) {
      const { title = type.charAt(0).toUpperCase() + type.slice(1), duration = 3000, persist = false } = options;
      // Create toast element
      const toastEl = document.createElement("div");
      toastEl.className = `toast text-white bg-${type} border-0`;
      toastEl.setAttribute("role", "alert");
      toastEl.setAttribute("aria-live", "polite"); // Changed to "polite" for less intrusive updates
      toastEl.setAttribute("aria-atomic", "true");
      toastEl.setAttribute("aria-label", `${title} notification`);
    
      // Icon mapping for different types
      const icons = {
        success: "bi-check-circle-fill",
        danger: "bi-exclamation-triangle-fill",
        warning: "bi-exclamation-circle-fill",
        info: "bi-info-circle-fill",
      };
      const iconClass = icons[type] || "bi-bell-fill";
    
      // Toast content with header and body
      toastEl.innerHTML = `
        <div class="toast-header">
          <i class="bi ${iconClass} notification-icon"></i>
          <strong class="toast-title">${title}</strong>
          <small>${new Date().toLocaleTimeString()}</small>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">
          ${message}
        </div>
      `;
    
      // Append to container
      document.getElementById("toastContainer").appendChild(toastEl);
    
      // Initialize Bootstrap toast
      const toastOptions = persist ? { autohide: false } : { delay: duration };
      const toast = new bootstrap.Toast(toastEl, toastOptions);
      toast.show();
    
      // Clean up after hiding
      toastEl.addEventListener("hidden.bs.toast", () => toastEl.remove());
    
      // Save notification to array
      notifications.push({ message, type, title, date: new Date().toLocaleString() });
      saveData();
    }

    // Show popup message
    function showPopupMessage(message) {
      document.getElementById("popupMessageContent").innerHTML = message;
      const popupModal = new bootstrap.Modal(document.getElementById("popupMessageModal"));
      popupModal.show();
    }

    // Add to wishlist
    function addToWishlist(productId) {
      const product = products.find(p => p.id === productId);
      if (!product) return;
      if (wishlist.some(p => p.id === productId)) {
        showNotification(`${product.name} is already in your wishlist.`, "info");
      } else {
        wishlist.push(product);
        showNotification(`${product.name} added to your wishlist.`, "success");
        saveData();
        updateWishlistSection();
      }
    }

    // Update wishlist section
    function updateWishlistSection() {
      const wishlistContainer = document.getElementById("wishlistContainer");
      if (wishlist.length === 0) {
        wishlistContainer.innerHTML = "<p>Your wishlist is empty.</p>";
        return;
      }
      let html = "";
      wishlist.forEach((item, index) => {
        html += `
          <div class="card mb-3 shadow-sm product-card" onclick="showProductDetails(${item.id})" style="cursor: pointer;">
            <div class="row g-0">
              <div class="col-4">
                <img src="${item.images && item.images.length ? item.images[0] : 'https://via.placeholder.com/400x300?text=' + encodeURIComponent(item.name)}" class="img-fluid rounded-start" alt="${item.name}">
              </div>
              <div class="col-8">
                <div class="card-body">
                  <h5 class="card-title">${item.name}</h5>
                  <p class="card-text">${item.description}</p>
                  <button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); removeFromWishlist(${index})" aria-label="Remove ${item.name} from Wishlist"><i class="bi bi-trash me-1"></i> Remove</button>
                </div>
              </div>
            </div>
          </div>
        `;
      });
      wishlistContainer.innerHTML = html;
    }

    // Remove from wishlist
    function removeFromWishlist(index) {
      if (confirm("Are you sure you want to remove this item from your wishlist?")) {
        wishlist.splice(index, 1);
        updateWishlistSection();
        showNotification("Item removed from wishlist.", "info");
        saveData();
      }
    }

    // Update user activity
    function updateUserActivity() {
      if (currentUser) {
        currentUser.lastActivity = new Date().toISOString();
        const userIndex = users.findIndex(u => u.email === currentUser.email);
        if (userIndex !== -1) users[userIndex].lastActivity = currentUser.lastActivity;
        saveData();
      }
    }

    // Get active users (last 5 minutes)
    function getActiveUsers() {
      const now = new Date();
      const fiveMinutesAgo = new Date(now - 5 * 60 * 1000);
      return users.filter(user => new Date(user.lastActivity) > fiveMinutesAgo).length;
    }

    // Get live users (last 1 minute)
    function getLiveUsers() {
      const now = new Date();
      const oneMinuteAgo = new Date(now - 1 * 60 * 1000);
      return users.filter(user => new Date(user.lastActivity) > oneMinuteAgo).length;
    }

    // Update owner dashboard
    function updateOwnerDashboard() {
      document.getElementById("totalMembers").textContent = users.length;
      document.getElementById("activeUsers").textContent = getActiveUsers();
      document.getElementById("liveUsers").textContent = getLiveUsers();
    
      const totalOrders = orders.length;
      const activeOrders = orders.filter(order => !order.cancelled && !order.received).length;
      const cancelledOrders = orders.filter(order => order.cancelled).length;
      const receivedOrders = orders.filter(order => order.received).length;
    
      document.getElementById("totalOrders").textContent = totalOrders;
      document.getElementById("activeOrders").textContent = activeOrders;
      document.getElementById("cancelledOrders").textContent = cancelledOrders;
      document.getElementById("receivedOrders").textContent = receivedOrders;
    
      let orderHtml = "";
      orders.forEach((order, index) => {
        orderHtml += `
          <div class="card mb-3 shadow-sm order-card">
            <div class="card-header">Order #${index + 1}</div>
            <div class="card-body">
              <p><strong>Product:</strong> ${order.product.name}</p>
              <p><strong>Buyer:</strong> ${order.buyer.firstName} ${order.buyer.lastName}</p>
              <p><strong>Status:</strong> ${order.cancelled ? "Cancelled" : order.received ? "Received" : "Active"}</p>
              <p><strong>Address:</strong> ${order.address}</p>
              <p><strong>Mobile:</strong> ${order.mobile}</p>
              <button class="btn btn-info" data-bs-toggle="modal" data-bs-target="#sendMessageModal" onclick="setCurrentOrderIndex(${index})">Send Message</button>
            </div>
          </div>
        `;
      });
      document.getElementById("orderDetailsContainer").innerHTML = orderHtml;
    
      let locationsHtml = "";
      users.forEach(user => {
        locationsHtml += `
          <div class="card mb-3">
            <div class="card-body">
              <p><strong>User:</strong> ${user.firstName} ${user.lastName}</p>
              <p><strong>Location:</strong> ${user.location}</p>
            </div>
          </div>
        `;
      });
      document.getElementById("userLocationsContainer").innerHTML = locationsHtml;
    }
    
      let locationsHtml = "";
      users.forEach(user => {
        locationsHtml += `
          <div class="card mb-3">
            <div class="card-body">
              <p><strong>User:</strong> ${user.firstName} ${user.lastName}</p>
              <p><strong>Location:</strong> ${user.location}</p>
            </div>
          </div>
        `;
      });
      document.getElementById("userLocationsContainer").innerHTML = locationsHtml;
      function sendMessageToUser(orderIndex) {
        console.log("Sending message for order:", orderIndex);
        const order = orders[orderIndex];
        const message = prompt("Enter message to send to the user:");
        if (!message) {
          showNotification("Message cannot be empty.", "warning");
          return;
      }
        if (message) {
          const user = users.find(u => u.email === order.buyer.email);
          if (user) {
            if (!user.notifications) user.notifications = []; // Ensure notifications array exists
            user.notifications.push({
              message: `Message from Owner: ${message}`,
              type: "info",
              title: "Message from Owner",
              date: new Date().toLocaleString()
            });
            showNotification(`Message sent to user: ${user.firstName} ${user.lastName}`, "success");
            saveData();
          } else {
            showNotification("User not found.", "warning");
          }
        }
      }
    
    // Show section
    function showSection(sectionId) {
      document.querySelectorAll(".section").forEach(section => section.classList.remove("active-section", "fade-in"));
      const targetSection = document.getElementById(sectionId);
      targetSection.classList.add("active-section", "fade-in");
      if (sectionId !== "productDetailSection") {
        delete document.getElementById("productDetailSection").dataset.selectedSize;
        delete document.getElementById("productDetailSection").dataset.selectedColor;
      }
      updateUserActivity();
      if (sectionId === "shopSection") {
        applyFilters();
      } else if (sectionId === "menswearSection") {
        applyMenswearFilters();
      } else if (sectionId === "accessoriesSection") {
        applyAccessoriesFilters();
      } else if (sectionId === "wishlistSection") {
        updateWishlistSection();
      } else if (sectionId === "accountSection") {
        updateAccountSection();
      } else if (sectionId === "cartSection") {
        updateCartSection();
      } else if (sectionId === "notificationsSection") {
        updateNotifications();
      } else if (sectionId === "ordersSection") {
        updateOrdersList();
      } else if (sectionId === "sellerDashboard" || sectionId === "ownerDashboard") {
        if (currentUser && currentUser.email === "tedpole.in@gmail.com") {
          sectionId === "sellerDashboard" ? updateSellerDashboard() : updateOwnerDashboard();
        } else {
          showNotification("Access denied. Only the owner can view this dashboard.", "danger");
          showSection("homeSection");
        }
      }
    }

    // Generate product image HTML
    function generateProductImageHTML(product) {
      const defaultColor = product.color.split(",")[0].trim();
      const defaultImage = product.colorImages[defaultColor];
      return `<img id="mainProductImage" src="${defaultImage}" class="product-detail-img" alt="${product.name}" style="cursor: pointer;" onclick="showProductImagesModal(${product.id})">`;
    }

    // Buy form submission with enhanced thank-you card
    document.getElementById("buyForm").addEventListener("submit", function(e) {
      e.preventDefault();
      if (!currentUser) {
        showNotification("Please log in or sign up before placing an order.", "warning");
        showSection("loginSection");
        return;
      }
      const address = document.getElementById("shippingAddress").value;
      const mobile = document.getElementById("mobileNumber").value;
      const details = document.getElementById("additionalDetails").value;
      const daysRange = currentProductForPurchase.deliveryTime.match(/\d+-\d+/)[0];
      const maxDays = parseInt(daysRange.split("-")[1]);
      const orderDate = new Date();
      const estimatedDeliveryDate = new Date(orderDate);
      estimatedDeliveryDate.setDate(orderDate.getDate() + maxDays);
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      const formattedDate = estimatedDeliveryDate.toLocaleDateString('en-US', options);
      const order = {
        product: currentProductForPurchase,
        address,
        mobile,
        details,
        payment: "Cash on Delivery",
        date: orderDate.toLocaleString(),
        cancelled: false,
        cancellationReason: "",
        trackingStatus: "Order Confirmed",
        buyer: currentUser,
        qrData: `Order #${orders.length + 1}\nProduct: ${currentProductForPurchase.name}\nSize: ${currentProductForPurchase.selectedSize}\nColor: ${currentProductForPurchase.selectedColor}\nAddress: ${address}\nMobile: ${mobile}\nBuyer: ${currentUser.firstName} ${currentUser.lastName}\nDate: ${orderDate.toLocaleString()}`,
        received: false,
        receivedDate: null,
        shipped: false,           // New field
        shippedDate: null,        // New field
        departed: false,          // New field
        departedDate: null,       // New field
        rating: null,
        review: null
      };
      orders.push(order);
      const orderIndex = orders.length - 1;
      showPopupMessage(`
        <h5>Thank You for Your Order!</h5>
        <img src="${currentProductForPurchase.images[0]}" alt="${currentProductForPurchase.name}" style="max-width: 100px; margin-bottom: 10px;">
        <p><strong>Product:</strong> ${currentProductForPurchase.name}</p>
        <p><strong>Size:</strong> ${currentProductForPurchase.selectedSize}</p>
        <p><strong>Color:</strong> ${currentProductForPurchase.selectedColor}</p>
        <p><strong>Estimated Delivery:</strong> ${formattedDate}</p>
        <p><strong>Shipping Address:</strong> ${address}</p>
        <p>Your order has been placed successfully. We will deliver it to you soon.</p>
        <button class="btn btn-primary mt-3" data-bs-dismiss="modal" onclick="showOrderDetailPage(${orderIndex})">View Order Details</button>
      `);
      notifyOwner(`New order placed by: ${currentUser.firstName} ${currentUser.lastName} (${currentUser.email}) for product: ${order.product.name} (Size: ${order.product.selectedSize}, Color: ${order.product.selectedColor}) at ₹${order.product.price.toFixed(2)} - Order #${orderIndex + 1}`);
      saveData();
      const buyModal = bootstrap.Modal.getInstance(document.getElementById("buyModal"));
      buyModal.hide();
    });

    // Update cart count badge
    function updateCartCountBadge() {
      document.getElementById("footerBagBadge").textContent = cart.length;
    }

    // Update cart section
    function updateCartSection() {
      const cartContent = document.getElementById("cartContent");
      if (cart.length === 0) {
        cartContent.innerHTML = "<p>Your bag is empty.</p>";
        return;
      }
      let html = "";
      cart.forEach((item, index) => {
        html += `
          <div class="card mb-3 shadow-sm product-card" onclick="showProductDetails(${item.id})" style="cursor: pointer;">
            <div class="row g-0">
              <div class="col-4">
                <img src="${item.images && item.images.length ? item.images[0] : 'https://via.placeholder.com/400x300?text=' + encodeURIComponent(item.name)}" class="img-fluid rounded-start" alt="${item.name}">
              </div>
              <div class="col-8">
                <div class="card-body">
                  <h5 class="card-title">${item.name}</h5>
                  <p class="card-text">${item.description}</p>
                  <p class="card-text">Size: ${item.selectedSize}, Color: ${item.selectedColor}</p>
                  <p class="card-text"><small class="text-muted">${item.category} | <s>₹${(item.price * 1.2).toFixed(2)}</s> ₹${item.price.toFixed(2)}</small></p>
                  <button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); removeFromCart(${index})"><i class="bi bi-trash me-1"></i> Remove</button>
                </div>
              </div>
            </div>
          </div>
        `;
      });
      html += `<button class="btn btn-success">Checkout</button>`;
      cartContent.innerHTML = html;
    }

    // Remove from cart
    function removeFromCart(index) {
      if (confirm("Are you sure you want to remove this item from your bag?")) {
        cart.splice(index, 1);
        updateCartSection();
        updateCartCountBadge();
        showNotification("Item removed from bag.", "info");
        saveData();
      }
    }

    // Update account section
    function updateAccountSection() {
      const accountContent = document.getElementById("accountContent");
      if (currentUser) {
        accountContent.innerHTML = `
          <div class="card shadow-sm">
            <div class="card-body">
              <h3>Hello, ${currentUser.firstName} ${currentUser.lastName}</h3>
              <p><strong>Email:</strong> ${currentUser.email}</p>
              <p><strong>Mobile Number:</strong> ${currentUser.mobile || "Not provided"}</p>
              <button class="btn btn-secondary" onclick="logout()">Logout</button>
            </div>
          </div>
        `;
      } else {
        accountContent.innerHTML = "<p>No user details available. Please log in.</p>";
      }
    }

    // Calculate estimated delivery dates
    function calculateDeliveryDate(orderDate, deliveryTime) {
      const [minDays, maxDays] = deliveryTime.split('-').map(s => parseInt(s.trim().replace(' days', '')));
      const orderDateObj = new Date(orderDate);
      const minDeliveryDate = new Date(orderDateObj);
      minDeliveryDate.setDate(orderDateObj.getDate() + minDays);
      const maxDeliveryDate = new Date(orderDateObj);
      maxDeliveryDate.setDate(orderDateObj.getDate() + maxDays);
      return {
        min: minDeliveryDate.toLocaleDateString(),
        max: maxDeliveryDate.toLocaleDateString()
      };
    }


// Update orders list
function updateOrdersList(filter = currentOrdersFilter) {
  const ordersList = document.getElementById('ordersList');
  if (!currentUser) {
    ordersList.innerHTML = `
      <div class="text-center py-5">
        <i class="bi bi-box-seam" style="font-size: 3rem; color: #ddd;"></i>
        <h5 class="mt-3">No orders found</h5>
        <p>Please log in to view your orders</p>
        <button class="btn btn-primary mt-2" onclick="showSection('loginSection')">Log In</button>
      </div>
    `;
    return;
  }

  const userOrders = orders.filter(order => order.buyer.email === currentUser.email);
  let filteredOrders = [];

  switch (filter) {
    case 'active':
      filteredOrders = userOrders.filter(order => !order.cancelled && !order.received);
      break;
    case 'completed':
      filteredOrders = userOrders.filter(order => order.received);
      break;
    case 'cancelled':
      filteredOrders = userOrders.filter(order => order.cancelled);
      break;
    default:
      filteredOrders = userOrders;
  }

  if (filteredOrders.length === 0) {
    let message = '';
    switch (filter) {
      case 'active': message = 'You have no active orders'; break;
      case 'completed': message = 'You have no completed orders'; break;
      case 'cancelled': message = 'You have no cancelled orders'; break;
      default: message = 'You have not placed any orders yet';
    }
    ordersList.innerHTML = `
      <div class="text-center py-5">
        <i class="bi bi-box-seam" style="font-size: 3rem; color: #ddd;"></i>
        <h5 class="mt-3">${message}</h5>
        <button class="btn btn-primary mt-2" onclick="showSection('shopSection')">Start Shopping</button>
      </div>
    `;
    return;
  }

  let html = '';
  filteredOrders.forEach((order, index) => {
    const originalIndex = orders.findIndex(o => o === order);
    const productImage = order.product.images && order.product.images.length > 0 ? 
      order.product.images[0] : 'https://via.placeholder.com/100x100?text=No+Image';
    
    let statusBadgeClass = '';
    let statusText = '';
    
    if (order.cancelled) {
      statusBadgeClass = 'order-status-cancelled';
      statusText = 'Cancelled';
    } else if (order.received) {
      statusBadgeClass = 'order-status-delivered';
      statusText = 'Delivered';
    } else if (order.shipped) {
      statusBadgeClass = 'order-status-shipped';
      statusText = 'Shipped';
    } else {
      statusBadgeClass = 'order-status-confirmed';
      statusText = 'Confirmed';
    }

    html += `
      <div class="card order-card mb-3 ${order.cancelled ? 'cancelled-order' : ''}" 
           onclick="showOrderDetailPage(${originalIndex})">
        <div class="card-header d-flex justify-content-between align-items-center">
          <div>
            <span class="fw-bold">Order #${originalIndex + 1}</span>
            <span class="text-muted ms-2">${order.date}</span>
          </div>
          <span class="order-status-badge ${statusBadgeClass}">${statusText}</span>
        </div>
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-4 col-md-2">
              <img src="${productImage}" 
                   class="order-card-image" 
                   alt="${order.product.name}"
                   onclick="event.stopPropagation(); showProductImagesModal(${order.product.id})">
            </div>
            <div class="col-8 col-md-10">
              <h6>${order.product.name}</h6>
              <p class="mb-1">Size: ${order.product.selectedSize}, Color: ${order.product.selectedColor}</p>
              <p class="mb-1">Qty: 1</p>
              <p class="fw-bold">₹${order.product.price.toFixed(2)}</p>
            </div>
          </div>
        </div>
      </div>
    `;
  });
  ordersList.innerHTML = html;
}

// Filter orders
function filterOrders(filter) {
  currentOrdersFilter = filter;
  updateOrdersList(filter);
}

// Show order detail page
function showOrderDetailPage(orderIndex) {
  currentOrderIndex = orderIndex;
  const order = orders[orderIndex];
  const productImage = order.product.images && order.product.images.length > 0 
    ? order.product.images[0] 
    : 'https://via.placeholder.com/400x300?text=' + encodeURIComponent(order.product.name);
    let deleteButton = '';
    if (order.cancelled) {
      deleteButton = `
        <button class="btn btn-danger mt-3" onclick="deleteOrder(${orderIndex})">
          <i class="bi bi-trash me-1"></i> Delete Order
        </button>
      `;
    }

    let statusBadgeClass = order.cancelled ? 'order-status-cancelled' :
                          order.received ? 'order-status-delivered' :
                          order.shipped ? 'order-status-shipped' : 'order-status-confirmed';
    let statusText = order.cancelled ? 'Cancelled' :
                    order.received ? 'Delivered' :
                    order.shipped ? 'Shipped' : 'Confirmed';
  
    const daysRange = order.product.deliveryTime.match(/\d+-\d+/)[0];
    const [minDays, maxDays] = daysRange.split('-').map(Number);
    const orderDate = new Date(order.date);
    const minDeliveryDate = new Date(orderDate);
    minDeliveryDate.setDate(orderDate.getDate() + minDays);
    const maxDeliveryDate = new Date(orderDate);
    maxDeliveryDate.setDate(orderDate.getDate() + maxDays);
    const currentDate = new Date();
    const isWithinDeliveryWindow = currentDate <= maxDeliveryDate;
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    const formattedMinDate = minDeliveryDate.toLocaleDateString('en-US', options);
    const formattedMaxDate = maxDeliveryDate.toLocaleDateString('en-US', options);
  
    let timelineItems = [];
    if (order.cancelled) {
      timelineItems = [
        { date: order.date, title: 'Order Placed', description: 'Your order was placed', active: true },
        { date: order.cancellationDate || order.date, title: 'Order Cancelled', description: 'Your order was cancelled', active: true }
      ];
    } else {
      timelineItems = [
        { date: order.date, title: 'Order Placed', description: 'Your order has been confirmed', active: true }
      ];
      if (order.shipped) {
        timelineItems.push({
          date: order.shippedDate || order.date,
          title: 'Shipped',
          description: 'Your order has been shipped',
          active: true
        });
      }
      if (order.received) {
        timelineItems.push({
          date: order.receivedDate || order.date,
          title: 'Delivered',
          description: 'Your order has been delivered',
          active: true
        });
      } else {
        timelineItems.push({
          date: '',
          title: 'Estimated Delivery',
          description: `Expected between ${formattedMinDate} and ${formattedMaxDate}`,
          active: false
        });
      }
    }
  
    let timelineHtml = '';
    timelineItems.forEach((item) => {
      timelineHtml += `
        <div class="timeline-item ${item.active ? 'active' : ''}">
          <h6>${item.title}</h6>
          <p class="mb-1">${item.description}</p>
          ${item.date ? `<p class="timeline-date text-muted">${item.date}</p>` : ''}
        </div>
      `;
    });
  
    let actionButtons = '';
    if (!order.cancelled && !order.received) {
      actionButtons += `
        <div class="d-flex gap-2">
          <button class="btn btn-success flex-grow-1" onclick="markAsReceived(${orderIndex})">
            <i class="bi bi-check-circle me-1"></i> Mark as Received
          </button>
          <button class="btn btn-outline-danger flex-grow-1" 
                  data-bs-toggle="modal" 
                  data-bs-target="#cancelOrderModal">
            <i class="bi bi-x-circle me-1"></i> Cancel Order
          </button>
           <button class="btn btn-danger w-(-1)" onclick="deleteOrder(${orderIndex})">
                <i class="bi bi-trash me-1"></i> Delete Order
              </button>
        </div>
      `;
     
    }
    if (order.received && !order.rating) {
      actionButtons += `
        <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#reviewOrderModal">
          <i class="bi bi-star me-1"></i> Rate & Review
        </button>
      `;
    }
    if (order.received && order.rating) {
      actionButtons += `
        <button class="btn btn-outline-primary me-2" data-bs-toggle="modal" data-bs-target="#viewReviewModal">
          <i class="bi bi-star-fill me-1"></i> View Your Review
        </button>
      `;
    }
  
    const originalPriceDisplay = order.product.originalPrice && order.product.originalPrice > order.product.price 
      ? `<s>₹${order.product.originalPrice.toFixed(2)}</s> ` 
      : '';
  
    const detailContent = `
      <div class="row">
        <div class="col-md-8">
          <div class="order-detail-section">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h4>Order #${orderIndex + 1}</h4>
              <span class="order-status-badge ${statusBadgeClass}">${statusText}</span>
            </div>
            <div class="order-timeline">
              ${timelineHtml}
            </div>
            ${order.cancelled && order.cancellationReason ? `
              <div class="alert alert-danger mt-3">
                <h6>Cancellation Reason</h6>
                <p>${order.cancellationReason}</p>
              </div>
            ` : ''}
          </div>
          <div class="order-actions mt-4">
            ${actionButtons}
          </div>
        </div>
        <div class="col-md-4">
          <div class="order-detail-section">
            <h5 class="mb-3">Order Summary</h5>
            <div class="d-flex mb-3">
              <img src="${productImage}" class="rounded me-3" style="width: 150px; height: 150px; object-fit: cover; cursor: pointer;" 
                   alt="${order.product.name}" onclick="showProductImages('${order.product.images.join('|')}', '${order.product.name}')">
              <div>
                <h6>${order.product.name}</h6>
                <p class="mb-1 small">Size: ${order.product.selectedSize}, Color: ${order.product.selectedColor}</p>
                <p class="mb-1 small">Qty: 1</p>
                <p class="fw-bold">${originalPriceDisplay}₹${order.product.price.toFixed(2)}</p>
              </div>
            </div>
            <hr>
            <div class="mb-2 d-flex justify-content-between">
              <span>Subtotal:</span>
              <span>₹${order.product.price.toFixed(2)}</span>
            </div>
            <div class="mb-2 d-flex justify-content-between">
              <span>Shipping:</span>
              <span>FREE</span>
            </div>
            <div class="mb-3 d-flex justify-content-between">
              <span>Tax:</span>
              <span>₹0.00</span>
            </div>
            <hr>
            <div class="d-flex justify-content-between fw-bold">
              <span>Total:</span>
              <span>₹${order.product.price.toFixed(2)}</span>
            </div>
            <hr>
            <h6 class="mb-2">Payment Method</h6>
            <p class="mb-3">${order.payment}</p>
            <h6 class="mb-2">Shipping Address</h6>
            <p class="mb-1">${order.address}</p>
            <p class="mb-3">Phone: ${order.mobile}</p>
            <button class="btn btn-outline-primary w-100" onclick="showProductDetails(${order.product.id})">
              <i class="bi bi-cart me-1"></i> Buy Again
            </button>
             
          </div>
        </div>
      </div>
    `;
  
    document.getElementById("orderDetailPage").innerHTML = detailContent;
    showSection("orderDetailSection");
  }

// Delete order
function deleteOrder(orderIndex) {
  if (confirm("Are you sure you want to delete this order? This action cannot be undone.")) {
    orders.splice(orderIndex, 1);
    saveData();
    showNotification("Order deleted successfully.", "success");
    showSection("ordersSection");
    updateOrdersList();
  }
}

  function markAsReceived(orderIndex) {
    orders[orderIndex].received = true;
    orders[orderIndex].receivedDate = new Date().toLocaleString();
    showNotification('Order marked as received', 'success');
    saveData();
    showOrderDetailPage(orderIndex);
    updateOrdersList(currentOrdersFilter);
  }

  function confirmCancelOrder() {
    const reasonSelect = document.getElementById('cancelReason');
    const otherReason = document.getElementById('otherReason');
    let reason = reasonSelect.value;
    if (reason === '') {
      showNotification('Please select a cancellation reason', 'warning');
      return;
    }
    if (reason === 'Other') {
      reason = otherReason.value.trim();
      if (reason === '') {
        showNotification('Please specify the cancellation reason', 'warning');
        return;
      }
    }
    orders[currentOrderIndex].cancelled = true;
    orders[currentOrderIndex].cancellationReason = reason;
    orders[currentOrderIndex].cancellationDate = new Date().toLocaleString();
    showNotification('Order has been cancelled', 'info');
    saveData();
    const modal = bootstrap.Modal.getInstance(document.getElementById('cancelOrderModal'));
    modal.hide();
    setTimeout(() => {
      showOrderDetailPage(currentOrderIndex);
      updateOrdersList(currentOrdersFilter);
    }, 500);
  }

  function updateOrdersList(filter) {
    const ordersList = document.getElementById("ordersList");
    let filteredOrders = orders;
    if (filter === 'active') {
      filteredOrders = orders.filter(o => !o.cancelled && !o.received && !o.returned);
    }
    let html = '';
    filteredOrders.forEach((order, index) => {
      const status = order.cancelled ? 'Cancelled' : order.received ? 'Delivered' : order.shipped ? 'Shipped' : 'Confirmed';
      html += `
        <div class="card mb-3 order-card" onclick="showOrderDetailPage(${index})">
          <div class="card-body">
            <h5 class="card-title">Order #${index + 1}</h5>
            <p class="card-text">${order.product.name} - ₹${order.product.price.toFixed(2)}</p>
            <p class="card-text"><small class="text-muted">${order.date}</small></p>
            <span class="order-status-badge order-status-${status.toLowerCase()}">${status}</span>
          </div>
        </div>
      `;
    });
    ordersList.innerHTML = html || '<p>No orders found.</p>';
  }

  function filterOrders(filter) {
    currentOrdersFilter = filter;
    updateOrdersList(filter);
  }

  function init() {
    loadData();
    document.getElementById('cancelReason')?.addEventListener('change', function() {
      document.getElementById('otherReasonContainer').style.display = this.value === 'Other' ? 'block' : 'none';
    });
  }

  document.addEventListener('DOMContentLoaded', init);
  

// Initialize rating when review modal is shown
document.getElementById('reviewOrderModal')?.addEventListener('show.bs.modal', function() {
  const order = orders[currentOrderIndex];
  const ratingStars = document.getElementById('ratingStars');
  
  // Clear any previous selection
  ratingStars.querySelectorAll('span').forEach(star => {
    star.textContent = '☆';
  });
  
  // If there's an existing rating, highlight the stars
  if (order.rating) {
    highlightStars(order.rating);
  }
  
  // Reset the rating text
  document.getElementById('ratingText').textContent = 'Tap to rate';
  
  // Clear review fields
  document.getElementById('reviewTitle').value = '';
  document.getElementById('reviewText').value = '';
});

// Handle star rating selection
document.getElementById('ratingStars')?.addEventListener('click', function(e) {
  if (e.target.tagName === 'SPAN') {
    const value = parseInt(e.target.getAttribute('data-value'));
    highlightStars(value);
    
    // Update rating text
    const ratingText = document.getElementById('ratingText');
    ratingText.textContent = `${value} star${value !== 1 ? 's' : ''}`;
    ratingText.style.color = '#000';
    
    // Store the selected rating
    document.getElementById('ratingStars').dataset.selectedRating = value;
  }
});

// Function to highlight stars up to the selected value
function highlightStars(value) {
  const stars = document.getElementById('ratingStars').querySelectorAll('span');
  stars.forEach((star, index) => {
    const starValue = parseInt(star.getAttribute('data-value'));
    star.textContent = starValue <= value ? '★' : '☆';
    star.style.color = starValue <= value ? 'gold' : '#000';
  });
}

// Submit review function
function submitReview() {
  const ratingStars = document.getElementById('ratingStars');
  const selectedRating = ratingStars.dataset.selectedRating;
  const reviewTitle = document.getElementById('reviewTitle').value.trim();
  const reviewText = document.getElementById('reviewText').value.trim();
  
  if (!selectedRating) {
    showNotification('Please select a rating by tapping the stars', 'warning');
    return;
  }
  
  if (!reviewTitle) {
    showNotification('Please enter a title for your review', 'warning');
    return;
  }
  
  if (!reviewText) {
    showNotification('Please write your review', 'warning');
    return;
  }
  
  // Update the order with review details
  const order = orders[currentOrderIndex];
  order.rating = parseInt(selectedRating);
  order.reviewTitle = reviewTitle;
  order.review = reviewText;
  order.reviewDate = new Date().toLocaleString();
  
  // Save the data
  saveData();
  
  // Close the modal
  const modal = bootstrap.Modal.getInstance(document.getElementById('reviewOrderModal'));
  modal.hide();
  
  // Show success message
  showNotification('Thank you for your review!', 'success');
  
  // Update the order detail view
  showOrderDetailPage(currentOrderIndex);
}

// Confirm return order function
function confirmReturnOrder() {
  const returnReason = document.getElementById('returnReason').value;
  const returnOtherReason = document.getElementById('returnOtherReason').value.trim();
  const returnComments = document.getElementById('returnComments').value.trim();
  
  let reason = returnReason;
  if (returnReason === 'Other') {
    if (!returnOtherReason) {
      showNotification('Please specify the return reason', 'warning');
      return;
    }
    reason = returnOtherReason;
  }
  
  
  
  // Save the data
  saveData();
  
  // Close the modal
  const modal = bootstrap.Modal.getInstance(document.getElementById('returnOrderModal'));
  modal.hide();
  
  // Show success message
  showNotification('Your return request has been submitted', 'success');
  
  // Update the order detail view
  showOrderDetailPage(currentOrderIndex);
}

// Update the view review modal when shown
document.getElementById('viewReviewModal')?.addEventListener('show.bs.modal', function() {
  const order = orders[currentOrderIndex];
  const modal = document.getElementById('viewReviewModal');
  
  if (!order.rating) return;
  
  // Update the modal content with the review details
  modal.querySelector('.modal-title').textContent = `Your Review of ${order.product.name}`;
  
  const starsContainer = modal.querySelector('.rating-stars');
  starsContainer.innerHTML = '';
  for (let i = 1; i <= 5; i++) {
    starsContainer.innerHTML += i <= order.rating ? '★' : '☆';
  }
  
  modal.querySelector('h5').textContent = order.reviewTitle || 'Your Review';
  modal.querySelector('p').textContent = order.review || 'No review text provided.';
  modal.querySelector('.small').textContent = `Reviewed on ${order.reviewDate || 'Unknown date'}`;
});

// Add this to your existing showOrderDetailPage function where you generate the action buttons
// (This is already in your code, just showing where it fits)
/*
if (order.received && !order.returned && !order.rating) {
  actionButtons += `
    <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#reviewOrderModal">
      <i class="bi bi-star me-1"></i> Rate & Review
    </button>
    <button class="btn btn-outline-secondary me-2" data-bs-toggle="modal" data-bs-target="#returnOrderModal">
      <i class="bi bi-arrow-return-left me-1"></i> Return Item
    </button>
  `;
}
if (order.received && order.rating) {
  actionButtons += `
    <button class="btn btn-outline-primary me-2" data-bs-toggle="modal" data-bs-target="#viewReviewModal">
      <i class="bi bi-star-fill me-1"></i> View Your Review
    </button>
  `;
}
*/

    // Update menu account details
    function updateMenuAccountDetails() {
      const container = document.getElementById("menuAccountDetails");
      if (currentUser) {
        container.innerHTML = `<i class="bi bi-person-circle me-2"></i><h4 class="d-inline">${currentUser.firstName} ${currentUser.lastName}</h4><br><small>${currentUser.email}</small>`;
        if (currentUser.email === "tedpole.in@gmail.com") {
          document.getElementById("sellerDashboardMenuItem").style.display = "block";
          document.getElementById("ownerDashboardMenuItem").style.display = "block";
        }
      } else {
        container.innerHTML = `<h4>Welcome Guest</h4>`;
        document.getElementById("sellerDashboardMenuItem").style.display = "none";
        document.getElementById("ownerDashboardMenuItem").style.display = "none";
      }
    }

    // Logout
    function logout() {
      if (currentUser) {
        currentUser.isLoggedIn = false;
        currentUser.lastActivity = new Date().toISOString();
      }
      currentUser = null;
      showNotification("You have been logged out.", "info");
      saveData();
      updateHeaderProfile();
      updateMenuAccountDetails();
      showSection("homeSection");
    }

    // Header button actions
    document.getElementById("accountButton").addEventListener("click", () => currentUser ? showSection("accountSection") : showSection("loginSection"));
    document.getElementById("notificationButton").addEventListener("click", () => showSection("notificationsSection"));

    // Enhanced search functionality
function showSearchSuggestions() {
  const input = document.getElementById("searchSectionInput").value.toLowerCase();
  const suggestionsContainer = document.getElementById("searchSuggestions");
  
  if (input.length < 2) {
    suggestionsContainer.style.display = "none";
    return;
  }
  
  const suggestions = products.filter(product => 
    product.name.toLowerCase().includes(input) || 
    product.description.toLowerCase().includes(input) ||
    product.category.toLowerCase().includes(input)
  ).slice(0, 5);
  
  if (suggestions.length === 0) {
    suggestionsContainer.style.display = "none";
    return;
  }
  
  let html = '';
  suggestions.forEach(product => {
    html += `
      <a href="#" class="list-group-item list-group-item-action" 
         onclick="event.preventDefault(); document.getElementById('searchSectionInput').value='${product.name}'; suggestionsContainer.style.display='none';">
        <div class="d-flex align-items-center">
          <img src="${product.images[0]}" alt="${product.name}" style="width: 40px; height: 40px; object-fit: cover; margin-right: 10px;">
          <div>
            <h6 class="mb-0">${product.name}</h6>
            <small class="text-muted">${product.category}</small>
          </div>
        </div>
      </a>
    `;
  });
  
  suggestionsContainer.innerHTML = html;
  suggestionsContainer.style.display = "block";
}

function performSearch() {
  const query = document.getElementById("searchSectionInput").value.toLowerCase();
  const category = document.getElementById("searchCategory").value;
  const priceRange = document.getElementById("searchPrice").value;
  const minRating = document.getElementById("searchRating").value;
  const sortBy = document.getElementById("searchSort").value;
  
  let filteredProducts = [...products];
  
  // Apply search query
  if (query) {
    filteredProducts = filteredProducts.filter(p => 
      p.name.toLowerCase().includes(query) || 
      p.description.toLowerCase().includes(query)
  )}
  
  // Apply category filter
  if (category) {
    filteredProducts = filteredProducts.filter(p => p.category === category);
  }
  
  // Apply price range filter
  if (priceRange) {
    const [min, max] = priceRange.split("-").map(Number);
    filteredProducts = filteredProducts.filter(p => {
      if (max) return p.price >= min && p.price <= max;
      return p.price >= min;
    });
  }
  
  // Apply rating filter
  if (minRating) {
    filteredProducts = filteredProducts.filter(p => {
      const ratingInfo = getProductRating(p.id);
      return ratingInfo && ratingInfo.average >= minRating;
    });
  }
  
  // Apply sorting
  switch(sortBy) {
    case "price-low":
      filteredProducts.sort((a, b) => a.price - b.price);
      break;
    case "price-high":
      filteredProducts.sort((a, b) => b.price - a.price);
      break;
    case "rating":
      filteredProducts.sort((a, b) => {
        const ratingA = getProductRating(a.id)?.average || 0;
        const ratingB = getProductRating(b.id)?.average || 0;
        return ratingB - ratingA;
      });
      break;
    case "newest":
      // Assuming newer products have higher IDs
      filteredProducts.sort((a, b) => b.id - a.id);
      break;
    default:
      // Relevance - products matching query come first
      if (query) {
        filteredProducts.sort((a, b) => {
          const aMatches = a.name.toLowerCase().includes(query) ? 1 : 0;
          const bMatches = b.name.toLowerCase().includes(query) ? 1 : 0;
          return bMatches - aMatches;
        });
      }
  }
  
  displaySearchResults(filteredProducts);
  updateSearchActiveFilters(query, category, priceRange, minRating);
}

function displaySearchResults(results) {
  const container = document.getElementById("searchResultsContainer");
  const countElement = document.getElementById("searchResultsCount");
  
  countElement.textContent = `${results.length} ${results.length === 1 ? 'product' : 'products'} found`;
  
  if (results.length === 0) {
    container.innerHTML = `
      <div class="col-12 text-center py-5">
        <i class="bi bi-search" style="font-size: 3rem; color: #ccc;"></i>
        <h4 class="mt-3">No </h4>
        <p>Try adjusting your search or filters</p>
        <button class="btn btn-primary" onclick="clearSearchFilters()">Clear all filters</button>
      </div>
    `;
    return;
  }
  
  container.innerHTML = "";
  results.forEach(product => {
    const ratingInfo = getProductRating(product.id);
    const originalPrice = (product.price * 1.2).toFixed(2);
    const discount = ((originalPrice - product.price) / originalPrice * 100).toFixed(0);
    
    const card = `
      <div class="col-6 col-md-4 col-lg-3 mb-4">
        <div class="card h-100 product-card" onclick="showProductDetails(${product.id})">
          <div style="position: relative;">
            <img src="${product.images[0]}" class="card-img-top" alt="${product.name}" style="height: 200px; object-fit: cover;">
            ${discount > 0 ? `<span class="badge bg-danger position-absolute top-0 start-0 m-2">${discount}% OFF</span>` : ''}
            <button class="wishlist-btn position-absolute top-0 end-0 m-2" 
                    onclick="event.stopPropagation(); addToWishlist(${product.id})">
              <i class="bi bi-heart-fill" style="color: ${wishlist.some(p => p.id === product.id) ? 'red' : '#ccc'};"></i>
            </button>
          </div>
          <div class="card-body">
            <h5 class="card-title">${product.name}</h5>
            <p class="card-text text-muted" style="font-size: 0.9rem;">${product.description}</p>
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <span class="fw-bold">₹${product.price.toFixed(2)}</span>
                ${discount > 0 ? `<small class="text-decoration-line-through text-muted ms-1">₹${originalPrice}</small>` : ''}
              </div>
              ${ratingInfo ? `
                <div class="d-flex align-items-center">
                  <i class="bi bi-star-fill text-warning me-1"></i>
                  <small>${ratingInfo.average}</small>
                </div>
              ` : ''}
            </div>
          </div>
        </div>
      </div>
    `;
    container.innerHTML += card;
  });
}

function updateSearchActiveFilters(query, category, priceRange, minRating) {
  const container = document.getElementById("searchActiveFilters");
  let html = '';
  
  if (query) html += `<span class="badge bg-secondary me-2">Search: ${query}</span>`;
  if (category) html += `<span class="badge bg-primary me-2">Category: ${category}</span>`;
  if (priceRange) {
    const label = priceRange === "0-100" ? "Under ₹100" : 
                 priceRange === "100-200" ? "₹100-₹200" :
                 priceRange === "200-300" ? "₹200-₹300" : "₹300-₹500";
    html += `<span class="badge bg-info me-2">Price: ${label}</span>`;
  }
  if (minRating) html += `<span class="badge bg-warning me-2">Rating: ${minRating}+</span>`;
  
  container.innerHTML = html;
}

function clearSearchFilters() {
  document.getElementById("searchSectionInput").value = "";
  document.getElementById("searchCategory").value = "";
  document.getElementById("searchPrice").value = "";
  document.getElementById("searchRating").value = "";
  document.getElementById("searchSort").value = "relevance";
  document.getElementById("searchActiveFilters").innerHTML = "";
  displaySearchResults(products);
  document.getElementById("searchResultsCount").textContent = `${products.length} `;
}

    // Login form submission
    document.getElementById("loginForm")?.addEventListener("submit", function(e) {
      e.preventDefault();
      const email = document.getElementById("loginEmail").value;
      const password = document.getElementById("loginPassword").value;
      const user = users.find(u => u.email === email && u.password === password);
      if (user) {
        currentUser = user;
        currentUser.isLoggedIn = true;
        currentUser.lastActivity = new Date().toISOString();
        showNotification("Login successful!", "success");
        notifyOwner(`User logged in: ${currentUser.firstName} ${currentUser.lastName} (${currentUser.email})`);
        saveData();
        updateHeaderProfile();
        updateMenuAccountDetails();
        showSection("homeSection");
      } else {
        showNotification("Invalid email or password. Please sign up if you don't have an account.", "warning");
      }
    });

    // Sign up form submission
    document.getElementById("signupForm")?.addEventListener("submit", function(e) {
      e.preventDefault();
      const firstName = document.getElementById("firstName").value;
      const lastName = document.getElementById("lastName").value;
      const mobile = document.getElementById("mobileNumberSignUp").value;
      const email = document.getElementById("signupEmail").value;
      const password = document.getElementById("signupPassword").value;
      const confirmPassword = document.getElementById("confirmPassword").value;
      if (password !== confirmPassword) {
        showNotification("Passwords do not match!", "warning");
        return;
      }
      if (users.some(u => u.email === email)) {
        showNotification("User with this email already exists. Please log in.", "warning");
        return;
      }
      currentUser = { 
        firstName, 
        lastName, 
        email, 
        mobile, 
        password, 
        isLoggedIn: true, 
        lastActivity: new Date().toISOString(), 
        location: locations[Math.floor(Math.random() * locations.length)],
        notifications: [] // Initialize notifications array
      };
      users.push(currentUser);
      showNotification("Sign Up successful!", "success");
      notifyOwner(`New user signed up: ${currentUser.firstName} ${currentUser.lastName} (${currentUser.email})`);
      saveData();
      updateHeaderProfile();
      updateMenuAccountDetails();
      showSection("homeSection");
    });

    // Contact form submission
    document.getElementById("contactForm")?.addEventListener("submit", function(e) {
      e.preventDefault();
      showNotification("Message was sent", "success");
      this.reset();
    });

     // Apply filters for Shop section
  function applyFilters() {
    const size = document.getElementById("filterSize").value;
    const color = document.getElementById("filterColor").value;
    const price = document.getElementById("filterPrice").value;
    activeFilters = {};
    if (size) activeFilters.size = size;
    if (color) activeFilters.color = color;
    if (price) activeFilters.price = price;
    let filteredProducts = [...products];
    if (activeFilters.size) {
      filteredProducts = filteredProducts.filter(p => p.size.split(",").map(s => s.trim().toLowerCase()).includes(activeFilters.size.toLowerCase()));
    }
    if (activeFilters.color) {
      filteredProducts = filteredProducts.filter(p => p.color.split(",").map(c => c.trim().toLowerCase()).includes(activeFilters.color.toLowerCase()));
    }
    if (activeFilters.price) {
      const [min, max] = activeFilters.price.split("-").map(Number);
      filteredProducts = filteredProducts.filter(p => p.price >= min && p.price <= max);
    }
    generateProducts("shopProductContainer", filteredProducts);
    displayActiveFilters();
  }

  // Display active filters for Shop section
  function displayActiveFilters() {
    const activeFilterDisplay = document.getElementById("activeFilterDisplay");
    let html = "";
    if (Object.keys(activeFilters).length > 0) {
      html += '<div class="filter-tags">';
      if (activeFilters.size) html += `<span class="badge bg-primary me-2" style="cursor: pointer;" onclick="removeFilter('size')">Size: ${activeFilters.size} <i class="bi bi-x"></i></span>`;
      if (activeFilters.color) html += `<span class="badge bg-primary me-2" style="cursor: pointer;" onclick="removeFilter('color')">Color: ${activeFilters.color} <i class="bi bi-x"></i></span>`;
      if (activeFilters.price) html += `<span class="badge bg-primary me-2" style="cursor: pointer;" onclick="removeFilter('price')">Price: ${activeFilters.price} <i class="bi bi-x"></i></span>`;
      html += '</div>';
    }
    activeFilterDisplay.innerHTML = html;
  }

  // Remove filter for Shop section
  function removeFilter(filterType) {
    if (filterType === 'size') document.getElementById('filterSize').value = '';
    else if (filterType === 'color') document.getElementById('filterColor').value = '';
    else if (filterType === 'price') document.getElementById('filterPrice').value = '';
    applyFilters();
  }

  // Clear all filters for Shop section
  function clearAllFilters() {
    document.getElementById('filterSize').value = '';
    document.getElementById('filterColor').value = '';
    document.getElementById('filterPrice').value = '';
    activeFilters = {};
    generateProducts("shopProductContainer", products);
    displayActiveFilters();
  }

   // Apply filters for Men's Wear section
    function applyMenswearFilters() {
      const size = document.getElementById("menswearFilterSize").value;
      const color = document.getElementById("menswearFilterColor").value;
      const price = document.getElementById("menswearFilterPrice").value;
      menswearActiveFilters = {};
      if (size) menswearActiveFilters.size = size;
      if (color) menswearActiveFilters.color = color;
      if (price) menswearActiveFilters.price = price;
      let filteredProducts = products.filter(p => p.category === "Men's Wear");
      if (menswearActiveFilters.size) {
        filteredProducts = filteredProducts.filter(p => p.size.split(",").map(s => s.trim().toLowerCase()).includes(menswearActiveFilters.size.toLowerCase()));
      }
      if (menswearActiveFilters.color) {
        filteredProducts = filteredProducts.filter(p => p.color.split(",").map(c => c.trim().toLowerCase()).includes(menswearActiveFilters.color.toLowerCase()));
      }
      if (menswearActiveFilters.price) {
        const [min, max] = menswearActiveFilters.price.split("-").map(Number);
        filteredProducts = filteredProducts.filter(p => p.price >= min && p.price <= max);
      }
      generateProducts("menswearContainer", filteredProducts);
      displayMenswearActiveFilters();
    }

    // Display active filters for Men's Wear section
    function displayMenswearActiveFilters() {
      const activeFilterDisplay = document.getElementById("menswearActiveFilterDisplay");
      let html = "";
      if (Object.keys(menswearActiveFilters).length > 0) {
        html += '<div class="filter-tags">';
        if (menswearActiveFilters.size) html += `<span class="badge bg-primary me-2" style="cursor: pointer;" onclick="removeMenswearFilter('size')">Size: ${menswearActiveFilters.size} <i class="bi bi-x"></i></span>`;
        if (menswearActiveFilters.color) html += `<span class="badge bg-primary me-2" style="cursor: pointer;" onclick="removeMenswearFilter('color')">Color: ${menswearActiveFilters.color} <i class="bi bi-x"></i></span>`;
        if (menswearActiveFilters.price) html += `<span class="badge bg-primary me-2" style="cursor: pointer;" onclick="removeMenswearFilter('price')">Price: ${menswearActiveFilters.price} <i class="bi bi-x"></i></span>`;
        html += '</div>';
      }
      activeFilterDisplay.innerHTML = html;
    }

    // Remove filter for Men's Wear section
    function removeMenswearFilter(filterType) {
      if (filterType === 'size') document.getElementById('menswearFilterSize').value = '';
      else if (filterType === 'color') document.getElementById('menswearFilterColor').value = '';
      else if (filterType === 'price') document.getElementById('menswearFilterPrice').value = '';
      applyMenswearFilters();
    }

    // Clear filters for Men's Wear section
    function clearMenswearFilters() {
      document.getElementById("menswearFilterSize").value = "";
      document.getElementById("menswearFilterColor").value = "";
      document.getElementById("menswearFilterPrice").value = "";
      menswearActiveFilters = {};
      const menswearProducts = products.filter(p => p.category === "Men's Wear");
      generateProducts("menswearContainer", menswearProducts);
      displayMenswearActiveFilters();
    }

    // Apply filters for Accessories section
    function applyAccessoriesFilters() {
      const size = document.getElementById("accessoriesFilterSize").value;
      const color = document.getElementById("accessoriesFilterColor").value;
      const price = document.getElementById("accessoriesFilterPrice").value;
      accessoriesActiveFilters = {};
      if (size) accessoriesActiveFilters.size = size;
      if (color) accessoriesActiveFilters.color = color;
      if (price) accessoriesActiveFilters.price = price;
      let filteredProducts = products.filter(p => p.category === "Accessories");
      if (accessoriesActiveFilters.size) {
        filteredProducts = filteredProducts.filter(p => p.size.split(",").map(s => s.trim().toLowerCase()).includes(accessoriesActiveFilters.size.toLowerCase()));
      }
      if (accessoriesActiveFilters.color) {
        filteredProducts = filteredProducts.filter(p => p.color.split(",").map(c => c.trim().toLowerCase()).includes(accessoriesActiveFilters.color.toLowerCase()));
      }
      if (accessoriesActiveFilters.price) {
        const [min, max] = accessoriesActiveFilters.price.split("-").map(Number);
        filteredProducts = filteredProducts.filter(p => p.price >= min && p.price <= max);
      }
      generateProducts("accessoriesContainer", filteredProducts);
      displayAccessoriesActiveFilters();
    }

    // Display active filters for Accessories section
    function displayAccessoriesActiveFilters() {
      const activeFilterDisplay = document.getElementById("accessoriesActiveFilterDisplay");
      let html = "";
      if (Object.keys(accessoriesActiveFilters).length > 0) {
        html += '<div class="filter-tags">';
        if (accessoriesActiveFilters.size) html += `<span class="badge bg-primary me-2" style="cursor: pointer;" onclick="removeAccessoriesFilter('size')">Size: ${accessoriesActiveFilters.size} <i class="bi bi-x"></i></span>`;
        if (accessoriesActiveFilters.color) html += `<span class="badge bg-primary me-2" style="cursor: pointer;" onclick="removeAccessoriesFilter('color')">Color: ${accessoriesActiveFilters.color} <i class="bi bi-x"></i></span>`;
        if (accessoriesActiveFilters.price) html += `<span class="badge bg-primary me-2" style="cursor: pointer;" onclick="removeAccessoriesFilter('price')">Price: ${accessoriesActiveFilters.price} <i class="bi bi-x"></i></span>`;
        html += '</div>';
      }
      activeFilterDisplay.innerHTML = html;
    }

    // Remove filter for Accessories section
    function removeAccessoriesFilter(filterType) {
      if (filterType === 'size') document.getElementById('accessoriesFilterSize').value = '';
      else if (filterType === 'color') document.getElementById('accessoriesFilterColor').value = '';
      else if (filterType === 'price') document.getElementById('accessoriesFilterPrice').value = '';
      applyAccessoriesFilters();
    }

    // Clear filters for Accessories section
    function clearAccessoriesFilters() {
      document.getElementById("accessoriesFilterSize").value = "";
      document.getElementById("accessoriesFilterColor").value = "";
      document.getElementById("accessoriesFilterPrice").value = "";
      accessoriesActiveFilters = {};
      const accessoriesProducts = products.filter(p => p.category === "Accessories");
      generateProducts("accessoriesContainer", accessoriesProducts);
      displayAccessoriesActiveFilters();
    }
      // Notify owner
      function notifyOwner(message) {
        ownerNotifications.push({ message, date: new Date().toLocaleString() });
        saveData();
      }

       // Update notifications
       function updateNotifications() {
        const notificationsContent = document.getElementById("notificationsContent");
        if (notifications.length === 0) {
          notificationsContent.innerHTML = `
            <div class="col-12 text-center py-5">
              <i class="bi bi-bell" style="font-size: 3rem; color: #ddd;"></i>
              <h5 class="mt-3">No Notifications</h5>
              <p>You're all caught up!</p>
            </div>
          `;
        } else {
          notificationsContent.innerHTML = "";
          notifications.slice().reverse().forEach((notif, index) => {
            const card = `
              <div class="col-md-6 col-lg-4">
                <div class="card notification-card ${notif.type}">
                  <div class="card-header">
                    <i class="bi bi-bell-fill notification-icon"></i>
                    ${notif.date}
                  </div>
                  <div class="card-body">
                    <p class="notification-message">${notif.message}</p>
                   
                  </div>
                </div>
              </div>
            `;
            notificationsContent.innerHTML += card;
          });
        }
      }
         // Clear all notifications
         function clearNotifications() {
          if (notifications.length === 0) {
            showNotification("No notifications to clear.", "info");
            return;
          }
          if (confirm("Are you sure you want to clear all notifications?")) {
            notifications = [];
            saveData();
            updateNotifications();
            showNotification("All notifications cleared.", "success");
          }
        }
           // Update Seller Dashboard
           function updateSellerDashboard() {
            const sellerDashboardContent = document.getElementById("sellerDashboardContent");
            let html = "<h2>Users</h2>";
            if (users.length === 0) {
              html += "<p>No users yet.</p>";
            } else {
              html += '<div class="list-group">';
              users.forEach(user => {
                html += `
                  <div class="list-group-item">
                    <strong>${user.firstName} ${user.lastName}</strong><br>
                    <small>${user.email}</small><br>
                    <small>Mobile: ${user.mobile || "Not provided"}</small>
                  </div>
                `;
              });
              html += '</div>';
            }
            html += "<h2 class='mt-4'>Orders</h2>";
            if (orders.length === 0) {
              html += "<p>No orders yet.</p>";
            } else {
              orders.forEach((order, index) => {
                const productImage = order.product.images && order.product.images.length > 0 ? order.product.images[0] : 'https://via.placeholder.com/100x100?text=No+Image';
                html += `
                  <div class="card mb-3 shadow-sm order-card">
                    <div class="card-header">
                      Order #${index + 1} - ${order.date}
                    </div>
                    <div class="card-body">
                      <div class="row">
                        <div class="col-12 col-md-4 mb-3 mb-md-0">
                          <h6>Buyer Information</h6>
                          <p><strong>Name:</strong> ${order.buyer.firstName} ${order.buyer.lastName}</p>
                          <p><strong>Email:</strong> ${order.buyer.email}</p>
                          <p><strong>Mobile:</strong> ${order.mobile}</p>
                        </div>
                        <div class="col-12 col-md-4 mb-3 mb-md-0">
                          <h6>Product Information</h6>
                          <img src="${productImage}" alt="${order.product.name}" class="img-fluid mb-2" style="max-width:100px; max-height:100px;" >
                          <p><strong>Name:</strong> ${order.product.name}</p>
                          <p><strong>Description:</strong> ${order.product.description}</p>
                          <p><strong>Selected Size:</strong> ${order.product.selectedSize}</p>
                          <p><strong>Selected Color:</strong> ${order.product.selectedColor}</p>
                          <p><strong>Price:</strong> 
                            ${order.product.originalPrice && order.product.originalPrice > order.product.price ? 
                              `<s>₹${order.product.originalPrice.toFixed(2)}</s> ` : 
                              ''}
                            ₹${order.product.price.toFixed(2)}
                          </p>
                          <p><strong>Category:</strong> ${order.product.category}</p>
                        </div>
                        <div class="col-12 col-md-4">
                          <h6>Shipping Information</h6>
                          <p><strong>Address:</strong> ${order.address}</p>
                          <p><strong>Payment Method:</strong> ${order.payment}</p>
                          <p><strong>Status:</strong> ${order.cancelled ? 'Cancelled' : 'Active'}</p>
                          ${order.cancelled ? `<p><strong>Cancellation Reason:</strong> ${order.cancellationReason}</p>` : ''}
                        </div>
                      </div>
                      <div class="qr-code-container mt-3">
                        <h6>Order QR Code</h6>
                        <div id="qrcode-${index}"></div>
                      </div>
                    </div>
                    <div class="card-footer text-end">
                      <button class="btn btn-primary me-2" onclick="printOrder(${index})">Print</button>
                      <button class="btn btn-secondary" onclick="downloadOrder(${index})">Download</button>
                    </div>
                  </div>
                `;
              });
            }
            html += "<h2 class='mt-4'>Notifications</h2>";
            if (ownerNotifications.length === 0) {
              html += "<p>No notifications yet.</p>";
            } else {
              html += `<div class="d-flex justify-content-end mb-3">
                         <button class="btn btn-danger btn-sm" onclick="clearOwnerNotifications()">Clear Notifications</button>
                       </div>`;
              html += '<div class="list-group">';
              ownerNotifications.slice().reverse().forEach(notif => {
                html += `
                  <div class="list-group-item">
                    <i class="bi bi-bell-fill me-2"></i>
                    <strong>${notif.date}</strong>: ${notif.message}
                  </div>
                `;
              });
              html += '</div>';
            }
            sellerDashboardContent.innerHTML = html;
  
      // Generate QR codes for each order
      orders.forEach((order, index) => {
        const qrDiv = document.getElementById(`qrcode-${index}`);
        if (qrDiv) {
          new QRCode(qrDiv, {
            text: order.qrData,
            width: 128,
            height: 128
          });
        }
      });
    }
  
    // Clear owner notifications
    function clearOwnerNotifications() {
      if (confirm("Are you sure you want to clear all notifications?")) {
        ownerNotifications = [];
        saveData();
        updateSellerDashboard();
        showNotification("All notifications cleared.", "info");
      }
    }
  
    // Function to print order card with QR code
    function printOrder(index) {
      const orderCards = document.querySelectorAll('.order-card');
      if (index < 0 || index >= orderCards.length) return;
      const orderCard = orderCards[index];
      
      document.body.classList.add('print-mode');
      orderCard.classList.add('print-selected');
      
      window.print();
      
      window.addEventListener('afterprint', function() {
        document.body.classList.remove('print-mode');
        orderCard.classList.remove('print-selected');
      }, { once: true });
    }
  
    // Function to download order card as PNG with QR code
    function downloadOrder(index) {
      const orderCards = document.querySelectorAll('.order-card');
      if (index < 0 || index >= orderCards.length) return;
      const orderCard = orderCards[index];
      
      html2canvas(orderCard).then(canvas => {
        const link = document.createElement('a');
        link.href = canvas.toDataURL('image/png');
        link.download = `order_${index + 1}.png`;
        link.click();
      }).catch(error => {
        console.error('Error generating image:', error);
        showNotification('Failed to generate image for download.', 'danger');
      });
    }
  // Initialize
  loadData();
  // Update header profile function 
function updateHeaderProfile() {
 const headerProfile = document.getElementById('headerProfile');
 if (currentUser) {
   headerProfile.innerHTML = `<i class="bi bi-person-circle"></i> ${currentUser.firstName} ${currentUser.lastName}`;
 } else {
   headerProfile.innerHTML = `<i class="bi bi-person-circle"></i> Guest`;
 }
}
document.getElementById("sendMessageModal").addEventListener("hidden.bs.modal", function () {
  document.getElementById("messageText").value = "";
});
</script>
<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
